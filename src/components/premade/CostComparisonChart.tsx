/**
 * CostComparisonChart Component\n * \n * Visual cost analysis display component showing detailed cost breakdowns\n * between DIY, Premade, and Hybrid preparation modes with interactive\n * charts and detailed financial insights.\n * \n * @example\n * ```tsx\n * <CostComparisonChart\n *   costAnalysis={costAnalysisData}\n *   servingSize={250}\n *   batchSize={20}\n *   region=\"EU\"\n *   currency=\"EUR\"\n * />\n * ```\n */\n\n'use client';\n\nimport React, { useState, useMemo } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  BarChart3, \n  DollarSign, \n  TrendingUp, \n  TrendingDown, \n  Calculator, \n  PieChart,\n  Activity,\n  ArrowRight,\n  ArrowUp,\n  ArrowDown,\n  Info,\n  AlertCircle,\n  CheckCircle\n} from 'lucide-react';\nimport { ComprehensiveCostAnalysis } from '@/lib/premade-cost-analysis';\n\n/**\n * CostComparisonChart Props\n */\ninterface CostComparisonChartProps {\n  costAnalysis: ComprehensiveCostAnalysis;\n  servingSize?: number;\n  batchSize?: number;\n  region?: string;\n  currency?: string;\n  showDetailedBreakdown?: boolean;\n  className?: string;\n}\n\n/**\n * Chart Data Interface\n */\ninterface ChartData {\n  diy: {\n    total: number;\n    perServing: number;\n    label: string;\n    color: string;\n    details: {\n      ingredients: number;\n      labor: number;\n      equipment: number;\n      waste: number;\n    };\n  };\n  premade: {\n    total: number;\n    perServing: number;\n    label: string;\n    color: string;\n    details: {\n      syrupCost: number;\n      shipping: number;\n      timeValue: number;\n      convenience: number;\n    };\n  };\n  hybrid: {\n    total: number;\n    perServing: number;\n    label: string;\n    color: string;\n    details: {\n      baseSyrup: number;\n      additives: number;\n      labor: number;\n      equipment: number;\n    };\n  };\n}\n\n/**\n * Main CostComparisonChart Component\n */\nexport const CostComparisonChart: React.FC<CostComparisonChartProps> = ({\n  costAnalysis,\n  servingSize = 250,\n  batchSize = 20,\n  region = 'EU',\n  currency = 'EUR',\n  showDetailedBreakdown = true,\n  className = ''\n}) => {\n  const [activeTab, setActiveTab] = useState('overview');\n  const [selectedComparison, setSelectedComparison] = useState<'all' | 'diy-vs-premade' | 'diy-vs-hybrid' | 'premade-vs-hybrid'>('all');\n  \n  // Process cost analysis data for charts\n  const chartData: ChartData = useMemo(() => ({\n    diy: {\n      total: costAnalysis.diy.totalCost,\n      perServing: costAnalysis.diy.costPerServing,\n      label: 'DIY Recipe',\n      color: 'bg-blue-500',\n      details: {\n        ingredients: costAnalysis.diy.ingredientCost,\n        labor: costAnalysis.diy.laborCost,\n        equipment: costAnalysis.diy.equipmentCost,\n        waste: costAnalysis.diy.wasteCost\n      }\n    },\n    premade: {\n      total: costAnalysis.premade.totalCost,\n      perServing: costAnalysis.premade.costPerServing,\n      label: 'Premade Syrups',\n      color: 'bg-green-500',\n      details: {\n        syrupCost: costAnalysis.premade.syrupCost,\n        shipping: costAnalysis.premade.shippingCost,\n        timeValue: costAnalysis.premade.timeSavingsValue,\n        convenience: costAnalysis.premade.conveniencePremium\n      }\n    },\n    hybrid: {\n      total: costAnalysis.hybrid.totalCost,\n      perServing: costAnalysis.hybrid.costPerServing,\n      label: 'Hybrid Mode',\n      color: 'bg-purple-500',\n      details: {\n        baseSyrup: costAnalysis.hybrid.syrupCost,\n        additives: costAnalysis.hybrid.additiveCost,\n        labor: costAnalysis.hybrid.laborCost,\n        equipment: costAnalysis.hybrid.equipmentCost\n      }\n    }\n  }), [costAnalysis]);\n  \n  // Calculate savings and differences\n  const savings = {\n    vsPremade: {\n      amount: costAnalysis.diy.totalCost - costAnalysis.premade.totalCost,\n      percentage: ((costAnalysis.diy.totalCost - costAnalysis.premade.totalCost) / costAnalysis.diy.totalCost) * 100\n    },\n    vsHybrid: {\n      amount: costAnalysis.diy.totalCost - costAnalysis.hybrid.totalCost,\n      percentage: ((costAnalysis.diy.totalCost - costAnalysis.hybrid.totalCost) / costAnalysis.diy.totalCost) * 100\n    },\n    premadeVsHybrid: {\n      amount: costAnalysis.premade.totalCost - costAnalysis.hybrid.totalCost,\n      percentage: ((costAnalysis.premade.totalCost - costAnalysis.hybrid.totalCost) / costAnalysis.premade.totalCost) * 100\n    }\n  };\n  \n  // Get maximum cost for chart scaling\n  const maxCost = Math.max(chartData.diy.total, chartData.premade.total, chartData.hybrid.total);\n  \n  // Determine recommended approach\n  const recommendedApproach = costAnalysis.recommendation.preferred;\n  const confidence = costAnalysis.recommendation.confidence;\n  \n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            Cost Analysis & Comparison\n          </h3>\n          <p className=\"text-sm text-gray-600\">\n            Detailed financial breakdown for {batchSize} servings ({servingSize}ml each)\n          </p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Badge variant=\"outline\" className=\"flex items-center space-x-1\">\n            <TrendingUp className=\"h-3 w-3\" />\n            <span>{recommendedApproach.toUpperCase()}</span>\n          </Badge>\n          <Badge variant=\"secondary\" className=\"flex items-center space-x-1\">\n            <span>{confidence}% confidence</span>\n          </Badge>\n        </div>\n      </div>\n      \n      {/* Cost Comparison Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\" className=\"flex items-center space-x-2\">\n            <BarChart3 className=\"h-4 w-4\" />\n            <span>Overview</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"breakdown\" className=\"flex items-center space-x-2\">\n            <PieChart className=\"h-4 w-4\" />\n            <span>Breakdown</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"savings\" className=\"flex items-center space-x-2\">\n            <TrendingUp className=\"h-4 w-4\" />\n            <span>Savings</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"trends\" className=\"flex items-center space-x-2\">\n            <Activity className=\"h-4 w-4\" />\n            <span>Trends</span>\n          </TabsTrigger>\n        </TabsList>\n        \n        {/* Overview Tab */}\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          {/* Main Cost Comparison */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-base\">Total Cost Comparison</CardTitle>\n              <CardDescription>\n                Complete cost analysis for {batchSize} servings\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"space-y-4\">\n                {/* Cost Bars */}\n                {Object.entries(chartData).map(([key, data]) => {\n                  const percentage = (data.total / maxCost) * 100;\n                  const isRecommended = recommendedApproach === key;\n                  \n                  return (\n                    <div key={key} className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-3\">\n                          <div className={`w-3 h-3 rounded-full ${data.color}`}></div>\n                          <span className=\"font-medium\">{data.label}</span>\n                          {isRecommended && (\n                            <Badge variant=\"default\" className=\"text-xs\">\n                              Recommended\n                            </Badge>\n                          )}\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"text-lg font-bold\">\n                            {currency} {data.total.toFixed(2)}\n                          </div>\n                          <div className=\"text-sm text-gray-500\">\n                            {currency} {data.perServing.toFixed(2)} per serving\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-3\">\n                        <div \n                          className={`h-3 rounded-full ${data.color} transition-all duration-500`}\n                          style={{ width: `${percentage}%` }}\n                        />\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n              \n              {/* Recommendation */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex items-start space-x-3\">\n                  <Info className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium text-blue-900 mb-2\">\n                      Recommended: {recommendedApproach.charAt(0).toUpperCase() + recommendedApproach.slice(1)}\n                    </div>\n                    <div className=\"space-y-1 text-sm text-blue-800\">\n                      {costAnalysis.recommendation.reasoning.map((reason, index) => (\n                        <div key={index} className=\"flex items-start space-x-2\">\n                          <CheckCircle className=\"h-3 w-3 text-blue-600 mt-0.5 flex-shrink-0\" />\n                          <span>{reason}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          \n          {/* Quick Metrics */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"p-2 bg-green-100 rounded-lg\">\n                    <DollarSign className=\"h-5 w-5 text-green-600\" />\n                  </div>\n                  <div>\n                    <div className=\"text-sm font-medium text-gray-700\">Best Value</div>\n                    <div className=\"text-lg font-bold text-gray-900\">\n                      {(() => {\n                        const costs = [\n                          { mode: 'DIY', cost: costAnalysis.diy.totalCost },\n                          { mode: 'Premade', cost: costAnalysis.premade.totalCost },\n                          { mode: 'Hybrid', cost: costAnalysis.hybrid.totalCost }\n                        ];\n                        const best = costs.reduce((min, curr) => curr.cost < min.cost ? curr : min);\n                        return `${best.mode} - ${currency} ${best.cost.toFixed(2)}`;\n                      })()}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"p-2 bg-blue-100 rounded-lg\">\n                    <Calculator className=\"h-5 w-5 text-blue-600\" />\n                  </div>\n                  <div>\n                    <div className=\"text-sm font-medium text-gray-700\">Per Serving</div>\n                    <div className=\"text-lg font-bold text-gray-900\">\n                      {currency} {Math.min(\n                        costAnalysis.diy.costPerServing,\n                        costAnalysis.premade.costPerServing,\n                        costAnalysis.hybrid.costPerServing\n                      ).toFixed(2)}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"p-2 bg-purple-100 rounded-lg\">\n                    <TrendingUp className=\"h-5 w-5 text-purple-600\" />\n                  </div>\n                  <div>\n                    <div className=\"text-sm font-medium text-gray-700\">Savings Potential</div>\n                    <div className=\"text-lg font-bold text-gray-900\">\n                      {currency} {Math.abs(Math.min(savings.vsPremade.amount, savings.vsHybrid.amount)).toFixed(2)}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n        \n        {/* Breakdown Tab */}\n        <TabsContent value=\"breakdown\" className=\"space-y-6\">\n          {showDetailedBreakdown && (\n            <div className=\"grid lg:grid-cols-3 gap-6\">\n              {/* DIY Breakdown */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base flex items-center space-x-2\">\n                    <div className=\"w-3 h-3 bg-blue-500 rounded-full\"></div>\n                    <span>DIY Breakdown</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {Object.entries(chartData.diy.details).map(([category, amount]) => {\n                    const percentage = (amount / chartData.diy.total) * 100;\n                    return (\n                      <div key={category} className=\"space-y-1\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span className=\"capitalize\">{category}</span>\n                          <span className=\"font-medium\">{currency} {amount.toFixed(2)}</span>\n                        </div>\n                        <Progress value={percentage} className=\"h-1.5\" />\n                      </div>\n                    );\n                  })}\n                </CardContent>\n              </Card>\n              \n              {/* Premade Breakdown */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base flex items-center space-x-2\">\n                    <div className=\"w-3 h-3 bg-green-500 rounded-full\"></div>\n                    <span>Premade Breakdown</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {Object.entries(chartData.premade.details).map(([category, amount]) => {\n                    const percentage = (amount / chartData.premade.total) * 100;\n                    return (\n                      <div key={category} className=\"space-y-1\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span className=\"capitalize\">{category.replace(/([A-Z])/g, ' $1').trim()}</span>\n                          <span className=\"font-medium\">{currency} {amount.toFixed(2)}</span>\n                        </div>\n                        <Progress value={percentage} className=\"h-1.5\" />\n                      </div>\n                    );\n                  })}\n                </CardContent>\n              </Card>\n              \n              {/* Hybrid Breakdown */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base flex items-center space-x-2\">\n                    <div className=\"w-3 h-3 bg-purple-500 rounded-full\"></div>\n                    <span>Hybrid Breakdown</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {Object.entries(chartData.hybrid.details).map(([category, amount]) => {\n                    const percentage = (amount / chartData.hybrid.total) * 100;\n                    return (\n                      <div key={category} className=\"space-y-1\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span className=\"capitalize\">{category}</span>\n                          <span className=\"font-medium\">{currency} {amount.toFixed(2)}</span>\n                        </div>\n                        <Progress value={percentage} className=\"h-1.5\" />\n                      </div>\n                    );\n                  })}\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </TabsContent>\n        \n        {/* Savings Tab */}\n        <TabsContent value=\"savings\" className=\"space-y-6\">\n          <div className=\"grid gap-4\">\n            {/* Savings Overview */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Cost Savings Analysis</CardTitle>\n                <CardDescription>\n                  Detailed savings breakdown compared to the most expensive option\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {Object.entries(savings).map(([comparison, data]) => {\n                    const isPositive = data.amount > 0;\n                    const ComparisonIcon = isPositive ? TrendingUp : TrendingDown;\n                    const colorClass = isPositive ? 'text-green-600' : 'text-red-600';\n                    \n                    return (\n                      <div key={comparison} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                        <div className=\"flex items-center space-x-3\">\n                          <ComparisonIcon className={`h-5 w-5 ${colorClass}`} />\n                          <div>\n                            <div className=\"font-medium text-gray-900 capitalize\">\n                              {comparison.replace(/([A-Z])/g, ' $1').trim()}\n                            </div>\n                            <div className=\"text-sm text-gray-600\">\n                              {isPositive ? 'Savings of' : 'Additional cost of'} {currency} {Math.abs(data.amount).toFixed(2)}\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className={`font-bold ${colorClass}`}>\n                            {isPositive ? '-' : '+'}{Math.abs(data.percentage).toFixed(1)}%\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n            \n            {/* Optimization Opportunities */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Cost Optimization Opportunities</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {costAnalysis.optimizationOpportunities.costReduction.map((opportunity, index) => (\n                    <div key={index} className=\"flex items-start space-x-3 p-3 bg-green-50 rounded-lg\">\n                      <TrendingUp className=\"h-4 w-4 text-green-600 mt-0.5\" />\n                      <div className=\"flex-1\">\n                        <div className=\"font-medium text-green-800\">{opportunity.description}</div>\n                        <div className=\"text-sm text-green-700\">\n                          Potential savings: {currency} {opportunity.potentialSavings.toFixed(2)}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n        \n        {/* Trends Tab */}\n        <TabsContent value=\"trends\" className=\"space-y-6\">\n          <div className=\"grid gap-4\">\n            {/* Market Trends */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Market Trends & Insights</CardTitle>\n                <CardDescription>\n                  Analysis of market factors affecting costs\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg\">\n                    <div>\n                      <div className=\"font-medium text-blue-800\">Price Volatility</div>\n                      <div className=\"text-sm text-blue-700\">\n                        {costAnalysis.marketTrends.priceVolatility} volatility in {region}\n                      </div>\n                    </div>\n                    <Badge variant=\"outline\" className=\"capitalize\">\n                      {costAnalysis.marketTrends.priceVolatility}\n                    </Badge>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between p-3 bg-purple-50 rounded-lg\">\n                    <div>\n                      <div className=\"font-medium text-purple-800\">Seasonal Impact</div>\n                      <div className=\"text-sm text-purple-700\">\n                        {Math.round(costAnalysis.marketTrends.seasonalFactors.reduce((sum, factor) => sum + Math.abs(factor.impact), 0))}% average seasonal variation\n                      </div>\n                    </div>\n                    <Badge variant=\"outline\">\n                      Moderate\n                    </Badge>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between p-3 bg-orange-50 rounded-lg\">\n                    <div>\n                      <div className=\"font-medium text-orange-800\">Future Outlook</div>\n                      <div className=\"text-sm text-orange-700\">\n                        {costAnalysis.marketTrends.futureOutlook}\n                      </div>\n                    </div>\n                    <Badge variant=\"outline\">\n                      Forecast\n                    </Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            {/* Regional Factors */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-base\">Regional Cost Factors</CardTitle>\n                <CardDescription>\n                  {region} market-specific considerations\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium text-gray-700\">Tax Rate</span>\n                    <span className=\"text-sm font-bold\">{(costAnalysis.regionalPricing.taxRate * 100).toFixed(1)}%</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium text-gray-700\">Shipping Cost</span>\n                    <span className=\"text-sm font-bold\">{currency} {costAnalysis.regionalPricing.shippingCost.toFixed(2)}</span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium text-gray-700\">Availability Factor</span>\n                    <span className=\"text-sm font-bold\">{(costAnalysis.regionalPricing.availabilityFactor * 100).toFixed(0)}%</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};\n\nexport default CostComparisonChart;"
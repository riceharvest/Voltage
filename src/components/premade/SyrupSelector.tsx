/**
 * SyrupSelector Component
 * 
 * Interactive syrup selection component with previews, filtering,\n * and real-time recommendations for the enhanced calculator.\n * \n * @example\n * ```tsx\n * <SyrupSelector\n *   targetFlavor=\"vanilla\"\n *   onSyrupSelect={(syrup) => setSelectedSyrup(syrup)}\n *   selectedSyrup={currentSyrup}\n *   budget={15}\n * />\n * ```\n */\n\n'use client';\n\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Slider } from '@/components/ui/slider';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  Search, \n  Filter, \n  Star, \n  Package, \n  DollarSign, \n  Clock, \n  Award,\n  CheckCircle,\n  AlertCircle,\n  TrendingUp,\n  Coffee,\n  RefreshCw\n} from 'lucide-react';\nimport { PremadeSyrup, SyrupRecommendation } from '@/lib/types';\nimport { PremadeSyrupService } from '@/lib/premade-syrups';\n\n/**\n * SyrupSelector Props\n */\ninterface SyrupSelectorProps {\n  targetFlavor: string;\n  onSyrupSelect: (syrup: PremadeSyrup) => void;\n  selectedSyrup?: PremadeSyrup | null;\n  budget?: number;\n  brand?: string;\n  quality?: 'budget' | 'standard' | 'premium';\n  onRecommendationsChange?: (recommendations: SyrupRecommendation[]) => void;\n  className?: string;\n}\n\n/**\n * Filter State Interface\n */\ninterface FilterState {\n  search: string;\n  brand: string;\n  category: string;\n  concentration: string;\n  maxPrice: number;\n  minRating: number;\n  availability: string;\n}\n\n/**\n * Main SyrupSelector Component\n */\nexport const SyrupSelector: React.FC<SyrupSelectorProps> = ({\n  targetFlavor,\n  onSyrupSelect,\n  selectedSyrup,\n  budget = 50,\n  brand,\n  quality = 'standard',\n  onRecommendationsChange,\n  className = ''\n}) => {\n  const [recommendations, setRecommendations] = useState<SyrupRecommendation[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [activeTab, setActiveTab] = useState('recommended');\n  const [filters, setFilters] = useState<FilterState>({\n    search: '',\n    brand: brand || '',\n    category: '',\n    concentration: '',\n    maxPrice: budget,\n    minRating: 0,\n    availability: ''\n  });\n  \n  // Initialize syrup service\n  const syrupService = useMemo(() => new PremadeSyrupService(), []);\n  \n  // Load recommendations when target flavor changes\n  useEffect(() => {\n    const loadRecommendations = async () => {\n      setLoading(true);\n      try {\n        const recs = syrupService.getRecommendations(targetFlavor, {\n          budget,\n          brand: filters.brand || undefined,\n          availability: filters.availability || undefined\n        });\n        setRecommendations(recs);\n        onRecommendationsChange?.(recs);\n      } catch (error) {\n        console.error('Failed to load recommendations:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    if (targetFlavor) {\n      loadRecommendations();\n    }\n  }, [targetFlavor, budget, filters.brand, filters.availability, syrupService, onRecommendationsChange]);\n  \n  // Apply filters to recommendations\n  const filteredRecommendations = useMemo(() => {\n    return recommendations.filter(rec => {\n      const syrup = rec.syrup;\n      \n      // Search filter\n      if (filters.search) {\n        const searchLower = filters.search.toLowerCase();\n        if (!syrup.name.toLowerCase().includes(searchLower) &&\n            !syrup.brand.toLowerCase().includes(searchLower) &&\n            !syrup.description.toLowerCase().includes(searchLower)) {\n          return false;\n        }\n      }\n      \n      // Category filter\n      if (filters.category && syrup.category !== filters.category) {\n        return false;\n      }\n      \n      // Concentration filter\n      if (filters.concentration && syrup.concentration !== filters.concentration) {\n        return false;\n      }\n      \n      // Price filter\n      const minPrice = Math.min(...Object.values(syrup.regionalPricing).map(p => p.price));\n      if (minPrice > filters.maxPrice) {\n        return false;\n      }\n      \n      // Rating filter\n      if (syrup.rating < filters.minRating) {\n        return false;\n      }\n      \n      return true;\n    });\n  }, [recommendations, filters]);\n  \n  // Get available filter options\n  const availableBrands = useMemo(() => syrupService.getBrands(), [syrupService]);\n  const availableCategories = useMemo(() => syrupService.getCategories(), [syrupService]);\n  const availableConcentrations = useMemo(() => syrupService.getConcentrations(), [syrupService]);\n  \n  // Handle filter changes\n  const updateFilter = (key: keyof FilterState, value: any) => {\n    setFilters(prev => ({ ...prev, [key]: value }));\n  };\n  \n  // Clear all filters\n  const clearFilters = () => {\n    setFilters({\n      search: '',\n      brand: brand || '',\n      category: '',\n      concentration: '',\n      maxPrice: budget,\n      minRating: 0,\n      availability: ''\n    });\n  };\n  \n  if (loading) {\n    return (\n      <div className={`space-y-4 ${className}`}>\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold\">Loading syrup recommendations...</h3>\n          <RefreshCw className=\"h-5 w-5 animate-spin\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i} className=\"h-48\">\n              <CardHeader>\n                <div className=\"animate-pulse\">\n                  <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                </div>\n              </CardHeader>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            Syrup Recommendations for {targetFlavor}\n          </h3>\n          <p className=\"text-sm text-gray-600\">\n            {filteredRecommendations.length} syrups found\n            {budget && ` within €${budget} budget`}\n          </p>\n        </div>\n        <Button variant=\"outline\" onClick={clearFilters} size=\"sm\">\n          <Filter className=\"h-4 w-4 mr-2\" />\n          Clear Filters\n        </Button>\n      </div>\n      \n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Filters</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            {/* Search */}\n            <div>\n              <Label htmlFor=\"search\">Search</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <Input\n                  id=\"search\"\n                  placeholder=\"Search syrups...\"\n                  value={filters.search}\n                  onChange={(e) => updateFilter('search', e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            \n            {/* Brand */}\n            <div>\n              <Label>Brand</Label>\n              <Select value={filters.brand} onValueChange={(value) => updateFilter('brand', value)}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All brands\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"\">All brands</SelectItem>\n                  {availableBrands.map(brand => (\n                    <SelectItem key={brand} value={brand}>{brand}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            {/* Category */}\n            <div>\n              <Label>Category</Label>\n              <Select value={filters.category} onValueChange={(value) => updateFilter('category', value)}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"All categories\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"\">All categories</SelectItem>\n                  {availableCategories.map(category => (\n                    <SelectItem key={category} value={category}>\n                      {category.charAt(0).toUpperCase() + category.slice(1)}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            {/* Max Price */}\n            <div>\n              <Label>Max Price: €{filters.maxPrice}</Label>\n              <Slider\n                value={[filters.maxPrice]}\n                onValueChange={(value) => updateFilter('maxPrice', value[0])}\n                max={budget * 2}\n                min={5}\n                step={5}\n                className=\"mt-2\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n      \n      {/* Recommendations */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"recommended\" className=\"flex items-center space-x-2\">\n            <Award className=\"h-4 w-4\" />\n            <span>Recommended ({filteredRecommendations.length})</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"popular\" className=\"flex items-center space-x-2\">\n            <TrendingUp className=\"h-4 w-4\" />\n            <span>Popular</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"budget\" className=\"flex items-center space-x-2\">\n            <DollarSign className=\"h-4 w-4\" />\n            <span>Budget Friendly</span>\n          </TabsTriggern>\n        </TabsList>\n        \n        <TabsContent value=\"recommended\" className=\"space-y-4\">\n          {filteredRecommendations.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {filteredRecommendations.map((rec) => (\n                <SyrupRecommendationCard\n                  key={rec.syrup.id}\n                  recommendation={rec}\n                  isSelected={selectedSyrup?.id === rec.syrup.id}\n                  onSelect={() => onSyrupSelect(rec.syrup)}\n                />\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-8\">\n              <Package className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No syrups found</h3>\n              <p className=\"text-gray-600\">Try adjusting your search criteria or filters</p>\n            </div>\n          )}\n        </TabsContent>\n        \n        <TabsContent value=\"popular\" className=\"space-y-4\">\n          <PopularSyrupsDisplay \n            syrupService={syrupService}\n            targetFlavor={targetFlavor}\n            onSyrupSelect={onSyrupSelect}\n            selectedSyrup={selectedSyrup}\n          />\n        </TabsContent>\n        \n        <TabsContent value=\"budget\" className=\"space-y-4\">\n          <BudgetFriendlySyrupsDisplay \n            recommendations={filteredRecommendations}\n            budget={budget}\n            onSyrupSelect={onSyrupSelect}\n            selectedSyrup={selectedSyrup}\n          />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};\n\n/**\n * Syrup Recommendation Card Component\n */\ninterface SyrupRecommendationCardProps {\n  recommendation: SyrupRecommendation;\n  isSelected: boolean;\n  onSelect: () => void;\n}\n\nconst SyrupRecommendationCard: React.FC<SyrupRecommendationCardProps> = ({\n  recommendation,\n  isSelected,\n  onSelect\n}) => {\n  const { syrup, compatibilityScore, reasons, estimatedCost } = recommendation;\n  \n  return (\n    <Card \n      className={`cursor-pointer transition-all duration-200 hover:shadow-md ${\n        isSelected ? 'ring-2 ring-primary border-primary' : 'border-gray-200'\n      }`}\n      onClick={onSelect}\n    >\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <CardTitle className=\"text-base font-semibold text-gray-900 line-clamp-2\">\n              {syrup.name}\n            </CardTitle>\n            <CardDescription className=\"text-sm text-gray-600 mt-1\">\n              {syrup.brand} • {syrup.category}\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            {isSelected && <CheckCircle className=\"h-5 w-5 text-primary\" />}\n            <div className=\"flex items-center space-x-1\">\n              <Star className=\"h-4 w-4 text-yellow-400 fill-current\" />\n              <span className=\"text-sm font-medium\">{syrup.rating.toFixed(1)}</span>\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"pt-0 space-y-3\">\n        {/* Compatibility Score */}\n        <div>\n          <div className=\"flex items-center justify-between mb-1\">\n            <span className=\"text-sm font-medium text-gray-700\">Match</span>\n            <span className=\"text-sm font-bold text-green-600\">{compatibilityScore}%</span>\n          </div>\n          <div className=\"w-full bg-gray-200 rounded-full h-2\">\n            <div \n              className=\"h-2 bg-green-500 rounded-full transition-all duration-300\"\n              style={{ width: `${compatibilityScore}%` }}\n            />\n          </div>\n        </div>\n        \n        {/* Pricing */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"text-lg font-bold text-gray-900\">\n              {estimatedCost.currency} {estimatedCost.amount.toFixed(2)}\n            </div>\n            <div className=\"text-xs text-gray-500\">\n              €{estimatedCost.pricePerMl.toFixed(3)}/ml\n            </div>\n          </div>\n          <Badge \n            variant={syrup.availability === 'in-stock' ? 'default' : 'secondary'}\n            className=\"text-xs\"\n          >\n            {syrup.availability}\n          </Badge>\n        </div>\n        \n        {/* Top Reasons */}\n        <div>\n          <div className=\"text-sm font-medium text-gray-700 mb-1\">Why this syrup?</div>\n          <div className=\"space-y-1\">\n            {reasons.slice(0, 2).map((reason, index) => (\n              <div key={index} className=\"flex items-start space-x-2 text-xs text-gray-600\">\n                <CheckCircle className=\"h-3 w-3 text-green-500 mt-0.5 flex-shrink-0\" />\n                <span>{reason}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n        \n        {/* Taste Profile Preview */}\n        <div>\n          <div className=\"flex flex-wrap gap-1\">\n            {syrup.tasteProfile.notes.slice(0, 3).map((note, index) => (\n              <Badge key={index} variant=\"outline\" className=\"text-xs\">\n                {note}\n              </Badge>\n            ))}\n            {syrup.tasteProfile.notes.length > 3 && (\n              <Badge variant=\"outline\" className=\"text-xs\">\n                +{syrup.tasteProfile.notes.length - 3}\n              </Badge>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\n/**\n * Popular Syrups Display Component\n */\ninterface PopularSyrupsDisplayProps {\n  syrupService: PremadeSyrupService;\n  targetFlavor: string;\n  onSyrupSelect: (syrup: PremadeSyrup) => void;\n  selectedSyrup?: PremadeSyrup | null;\n}\n\nconst PopularSyrupsDisplay: React.FC<PopularSyrupsDisplayProps> = ({\n  syrupService,\n  targetFlavor,\n  onSyrupSelect,\n  selectedSyrup\n}) => {\n  const [popularSyrups, setPopularSyrups] = useState<PremadeSyrup[]>([]);\n  \n  useEffect(() => {\n    const allSyrups = syrupService.getAllSyrups();\n    const popular = allSyrups\n      .sort((a, b) => b.reviewCount - a.reviewCount)\n      .slice(0, 6);\n    setPopularSyrups(popular);\n  }, [syrupService]);\n  \n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n      {popularSyrups.map((syrup) => (\n        <Card \n          key={syrup.id}\n          className={`cursor-pointer transition-all duration-200 hover:shadow-md ${\n            selectedSyrup?.id === syrup.id ? 'ring-2 ring-primary border-primary' : ''\n          }`}\n          onClick={() => onSyrupSelect(syrup)}\n        >\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-base font-semibold\">{syrup.name}</CardTitle>\n            <CardDescription>{syrup.brand}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-1\">\n                <Star className=\"h-4 w-4 text-yellow-400 fill-current\" />\n                <span className=\"text-sm font-medium\">{syrup.rating.toFixed(1)}</span>\n                <span className=\"text-xs text-gray-500\">({syrup.reviewCount})</span>\n              </div>\n              <div className=\"text-sm font-semibold\">\n                €{Math.min(...Object.values(syrup.regionalPricing).map(p => p.price)).toFixed(2)}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n};\n\n/**\n * Budget Friendly Syrups Display Component\n */\ninterface BudgetFriendlySyrupsDisplayProps {\n  recommendations: SyrupRecommendation[];\n  budget: number;\n  onSyrupSelect: (syrup: PremadeSyrup) => void;\n  selectedSyrup?: PremadeSyrup | null;\n}\n\nconst BudgetFriendlySyrupsDisplay: React.FC<BudgetFriendlySyrupsDisplayProps> = ({\n  recommendations,\n  budget,\n  onSyrupSelect,\n  selectedSyrup\n}) => {\n  const budgetFriendly = recommendations\n    .filter(rec => {\n      const minPrice = Math.min(...Object.values(rec.syrup.regionalPricing).map(p => p.price));\n      return minPrice <= budget * 0.7; // 30% under budget\n    })\n    .sort((a, b) => a.estimatedCost.amount - b.estimatedCost.amount)\n    .slice(0, 6);\n  \n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n        <DollarSign className=\"h-4 w-4\" />\n        <span>Showing syrups under €{(budget * 0.7).toFixed(0)} ({budgetFriendly.length} found)</span>\n      </div>\n      \n      {budgetFriendly.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {budgetFriendly.map((rec) => (\n            <Card \n              key={rec.syrup.id}\n              className={`cursor-pointer transition-all duration-200 hover:shadow-md ${\n                selectedSyrup?.id === rec.syrup.id ? 'ring-2 ring-primary border-primary' : ''\n              }`}\n              onClick={() => onSyrupSelect(rec.syrup)}\n            >\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <CardTitle className=\"text-base font-semibold\">{rec.syrup.name}</CardTitle>\n                    <CardDescription>{rec.syrup.brand}</CardDescription>\n                  </div>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    Budget Pick\n                  </Badge>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-lg font-bold text-green-600\">\n                      {rec.estimatedCost.currency} {rec.estimatedCost.amount.toFixed(2)}\n                    </div>\n                    <div className=\"text-xs text-gray-500\">\n                      Save €{(rec.estimatedCost.amount * 0.3).toFixed(2)}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-1\">\n                    <Star className=\"h-4 w-4 text-yellow-400 fill-current\" />\n                    <span className=\"text-sm font-medium\">{rec.syrup.rating.toFixed(1)}</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-8\">\n          <AlertCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No budget-friendly options</h3>\n          <p className=\"text-gray-600\">Try increasing your budget or adjusting filters</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SyrupSelector;"
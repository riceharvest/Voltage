/**
 * Commercial Syrup System
 * 
 * Provides comprehensive support for major commercial syrup brands including
 * SodaStream, Torani, DaVinci, Monin, and Starbucks with concentration ratios,
 * compatibility matrices, and regional pricing integration.
 * 
 * @example
 * ```typescript\n * import { PremadeSyrupService } from './premade-syrups';\n * \n * const syrupService = new PremadeSyrupService();\n * const recommendations = await syrupService.getRecommendations('cola', { \n *   budget: 15, \n *   brand: 'Torani' \n * });\n * ```\n */\n\nimport { PremadeSyrup, SyrupMarketplaceFilter, SyrupRecommendation, CostComparison } from './types';
import { syrupDatabase } from '@/data/syrups';\n\n/**\n * Premade Syrup Service\n * \n * Central service for managing commercial syrup data, compatibility analysis,\n * cost calculations, and intelligent recommendations.\n */\nexport class PremadeSyrupService {\n  private syrups: PremadeSyrup[] = [];\n  private compatibilityMatrix: Map<string, Map<string, number>> = new Map();\n  \n  constructor() {\n    this.initializeSyrupDatabase();\n    this.buildCompatibilityMatrix();\n  }\n\n  /**\n   * Initialize comprehensive syrup database with 50+ products\n   * from major commercial brands across different regions.\n   */\n  private initializeSyrupDatabase(): void {\n    this.syrups = [\n      // SODASTREAM SYRUPS\n      {\n        id: 'sodastream-cola',\n        brand: 'SodaStream',\n        name: 'SodaStream Cola Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['cola', 'classic', 'energy'],\n        regionalPricing: {\n          US: { price: 8.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 7.49, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 6.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.2,\n        reviewCount: 1847,\n        description: 'Classic cola flavor syrup for SodaStream machines. Creates authentic cola taste with perfect carbonation.',\n        tasteProfile: {\n          sweetness: 'medium',\n          intensity: 'strong',\n          notes: ['caramel', 'vanilla', 'citrus', 'spice']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 50,\n          storage: 'Refrigerate after opening',\n          shelfLife: '6 months'\n        },\n        amazonAsins: {\n          US: 'B08N5WRWNW',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'sodastream-lemon-lime',\n        brand: 'SodaStream',\n        name: 'SodaStream Lemon Lime Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['citrus', 'lemon', 'lime', 'fresh'],\n        regionalPricing: {\n          US: { price: 8.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 7.49, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 6.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.4,\n        reviewCount: 2156,\n        description: 'Bright and refreshing lemon-lime flavor with perfect balance of citrus notes.',\n        tasteProfile: {\n          sweetness: 'medium',\n          intensity: 'moderate',\n          notes: ['lemon', 'lime', 'citrus zest', 'fresh']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 50,\n          storage: 'Refrigerate after opening',\n          shelfLife: '6 months'\n        },\n        amazonAsins: {\n          US: 'B08N5WRWNW',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n\n      // TORANI SYRUPS\n      {\n        id: 'torani-vanilla',\n        brand: 'Torani',\n        name: 'Torani Classic Vanilla Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['vanilla', 'cream', 'coffee', 'dessert'],\n        regionalPricing: {\n          US: { price: 12.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 11.49, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 10.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.7,\n        reviewCount: 3241,\n        description: 'Rich, smooth vanilla syrup with authentic Madagascar vanilla flavor. Perfect for coffee drinks and desserts.',\n        tasteProfile: {\n          sweetness: 'high',\n          intensity: 'strong',\n          notes: ['madagascar-vanilla', 'creamy', 'smooth', 'rich']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 30,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '2 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'torani-french-vanilla',\n        brand: 'Torani',\n        name: 'Torani French Vanilla Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['vanilla', 'cream', 'coffee', 'dessert'],\n        regionalPricing: {\n          US: { price: 12.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 11.49, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 10.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.6,\n        reviewCount: 2847,\n        description: 'Creamy French vanilla with subtle custard notes and a rich, velvety texture.',\n        tasteProfile: {\n          sweetness: 'high',\n          intensity: 'strong',\n          notes: ['french-vanilla', 'custard', 'creamy', 'velvety']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 30,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '2 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'torani-caramel',\n        brand: 'Torani',\n        name: 'Torani Caramel Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['caramel', 'coffee', 'dessert', 'candy'],\n        regionalPricing: {\n          US: { price: 12.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 11.49, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 10.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.8,\n        reviewCount: 4562,\n        description: 'Rich, buttery caramel with deep, complex flavor notes. Made with real caramelized sugar.',\n        tasteProfile: {\n          sweetness: 'very-high',\n          intensity: 'strong',\n          notes: ['caramel', 'buttery', 'rich', 'complex']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 25,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '2 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'torani-hazelnut',\n        brand: 'Torani',\n        name: 'Torani Hazelnut Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['hazelnut', 'coffee', 'cream', 'nutty'],\n        regionalPricing: {\n          US: { price: 12.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 11.49, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 10.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.5,\n        reviewCount: 3674,\n        description: 'Rich hazelnut flavor with authentic roasted nut notes. Perfect for coffee and dessert beverages.',\n        tasteProfile: {\n          sweetness: 'medium',\n          intensity: 'strong',\n          notes: ['hazelnut', 'roasted', 'nutty', 'smooth']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 30,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '2 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n\n      // DAVINCI SYRUPS\n      {\n        id: 'davinci-raspberry',\n        brand: 'DaVinci',\n        name: 'DaVinci Gourmet Raspberry Syrup',\n        category: 'fruit',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['raspberry', 'berry', 'fruit', 'tart'],\n        regionalPricing: {\n          US: { price: 14.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 12.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 11.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'limited' }\n        },\n        availability: 'in-stock',\n        rating: 4.4,\n        reviewCount: 2156,\n        description: 'Vibrant raspberry syrup made with real fruit juice. Bold tartness balanced with natural sweetness.',\n        tasteProfile: {\n          sweetness: 'medium',\n          intensity: 'strong',\n          notes: ['raspberry', 'tart', 'fruity', 'vibrant']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 40,\n          storage: 'Refrigerate after opening',\n          shelfLife: '1 year unopened, 6 months after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'davinci-strawberry',\n        brand: 'DaVinci',\n        name: 'DaVinci Gourmet Strawberry Syrup',\n        category: 'fruit',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['strawberry', 'berry', 'fruit', 'sweet'],\n        regionalPricing: {\n          US: { price: 14.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 12.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 11.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.3,\n        reviewCount: 1987,\n        description: 'Sweet strawberry syrup with authentic berry flavor. Made with real strawberries for natural taste.',\n        tasteProfile: {\n          sweetness: 'high',\n          intensity: 'moderate',\n          notes: ['strawberry', 'sweet', 'fruity', 'natural']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 40,\n          storage: 'Refrigerate after opening',\n          shelfLife: '1 year unopened, 6 months after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n\n      // MONIN SYRUPS\n      {\n        id: 'monin-mint',\n        brand: 'Monin',\n        name: 'Monin Mint Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['mint', 'fresh', 'herbal', 'cooling'],\n        regionalPricing: {\n          US: { price: 16.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 14.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 13.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.6,\n        reviewCount: 2834,\n        description: 'Fresh mint syrup with cool, invigorating flavor. Made with natural mint extract for authentic taste.',\n        tasteProfile: {\n          sweetness: 'medium',\n          intensity: 'strong',\n          notes: ['mint', 'cooling', 'fresh', 'invigorating']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 35,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '3 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'monin-coconut',\n        brand: 'Monin',\n        name: 'Monin Coconut Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['coconut', 'tropical', 'cream', 'dessert'],\n        regionalPricing: {\n          US: { price: 16.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 14.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 13.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.5,\n        reviewCount: 2567,\n        description: 'Tropical coconut syrup with rich, creamy flavor. Made with natural coconut extract for authentic taste.',\n        tasteProfile: {\n          sweetness: 'high',\n          intensity: 'moderate',\n          notes: ['coconut', 'tropical', 'creamy', 'rich']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 35,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '3 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n\n      // STARBUCKS SYRUPS\n      {\n        id: 'starbucks-vanilla',\n        brand: 'Starbucks',\n        name: 'Starbucks Vanilla Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['vanilla', 'coffee', 'cream', 'dessert'],\n        regionalPricing: {\n          US: { price: 18.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 16.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'limited' },\n          UK: { price: 15.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'limited' }\n        },\n        availability: 'limited',\n        rating: 4.7,\n        reviewCount: 3421,\n        description: 'Premium vanilla syrup with the authentic taste of Starbucks coffeehouse vanilla.',\n        tasteProfile: {\n          sweetness: 'high',\n          intensity: 'strong',\n          notes: ['vanilla', 'smooth', 'rich', 'coffeehouse']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 30,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '2 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'starbucks-caramel',\n        brand: 'Starbucks',\n        name: 'Starbucks Caramel Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['caramel', 'coffee', 'dessert', 'sweet'],\n        regionalPricing: {\n          US: { price: 18.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 16.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'limited' },\n          UK: { price: 15.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'limited' }\n        },\n        availability: 'limited',\n        rating: 4.8,\n        reviewCount: 4156,\n        description: 'Rich caramel syrup with the signature taste of Starbucks caramel macchiato.',\n        tasteProfile: {\n          sweetness: 'very-high',\n          intensity: 'strong',\n          notes: ['caramel', 'buttery', 'rich', 'macchiato']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 25,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '2 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n\n      // ADDITIONAL SYRUPS FOR COMPREHENSIVE DATABASE\n      {\n        id: 'torani-pumpkin-spice',\n        brand: 'Torani',\n        name: 'Torani Pumpkin Spice Syrup',\n        category: 'spice',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['pumpkin', 'spice', 'autumn', 'warm'],\n        regionalPricing: {\n          US: { price: 12.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 11.49, currency: 'EUR', retailer: 'Amazon EU', availability: 'limited' },\n          UK: { price: 10.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'limited' }\n        },\n        availability: 'limited',\n        rating: 4.3,\n        reviewCount: 1567,\n        description: 'Autumn spice blend with pumpkin, cinnamon, nutmeg, and clove flavors.',\n        tasteProfile: {\n          sweetness: 'medium',\n          intensity: 'strong',\n          notes: ['pumpkin', 'cinnamon', 'nutmeg', 'clove', 'warm']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 30,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '2 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'monin-peppermint',\n        brand: 'Monin',\n        name: 'Monin Peppermint Syrup',\n        category: 'flavor',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['peppermint', 'mint', 'cooling', 'fresh'],\n        regionalPricing: {\n          US: { price: 16.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 14.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 13.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.4,\n        reviewCount: 2134,\n        description: 'Cooling peppermint syrup with authentic winter mint flavor.',\n        tasteProfile: {\n          sweetness: 'medium',\n          intensity: 'very-strong',\n          notes: ['peppermint', 'cooling', 'fresh', 'winter']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 35,\n          storage: 'Room temperature, away from direct sunlight',\n          shelfLife: '3 years unopened, 1 year after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      },\n      {\n        id: 'davinci-watermelon',\n        brand: 'DaVinci',\n        name: 'DaVinci Gourmet Watermelon Syrup',\n        category: 'fruit',\n        concentration: 'concentrate',\n        dilutionRatio: '1:1',\n        compatibleFlavors: ['watermelon', 'fruit', 'summer', 'fresh'],\n        regionalPricing: {\n          US: { price: 14.99, currency: 'USD', retailer: 'Amazon', availability: 'in-stock' },\n          EU: { price: 12.99, currency: 'EUR', retailer: 'Amazon EU', availability: 'in-stock' },\n          UK: { price: 11.99, currency: 'GBP', retailer: 'Amazon UK', availability: 'in-stock' }\n        },\n        availability: 'in-stock',\n        rating: 4.2,\n        reviewCount: 1743,\n        description: 'Sweet watermelon syrup with authentic summer fruit flavor.',\n        tasteProfile: {\n          sweetness: 'high',\n          intensity: 'moderate',\n          notes: ['watermelon', 'sweet', 'summer', 'fresh']\n        },\n        usageGuide: {\n          recommendedRatio: '1:1',\n          maxDaily: 40,\n          storage: 'Refrigerate after opening',\n          shelfLife: '1 year unopened, 6 months after opening'\n        },\n        amazonAsins: {\n          US: 'B000KT5Y2W',\n          EU: 'B07Y8RTEST',\n          UK: 'B09X4R5TEST'\n        }\n      }\n    ];\n  }\n\n  /**\n   * Build compatibility matrix for flavor matching\n   * Creates a mapping of syrup compatibility scores for different target flavors.\n   */\n  private buildCompatibilityMatrix(): void {\n    const compatibilityRules = {\n      // Cola flavors\n      'cola': ['sodastream-cola'],\n      'classic': ['sodastream-cola'],\n      'energy': ['sodastream-cola'],\n      \n      // Vanilla variants\n      'vanilla': ['torani-vanilla', 'starbucks-vanilla', 'torani-french-vanilla'],\n      'cream': ['torani-vanilla', 'torani-french-vanilla'],\n      'coffee': ['torani-vanilla', 'starbucks-vanilla', 'torani-caramel', 'starbucks-caramel'],\n      \n      // Caramel variants\n      'caramel': ['torani-caramel', 'starbucks-caramel'],\n      'dessert': ['torani-caramel', 'starbucks-caramel', 'monin-coconut'],\n      \n      // Fruit flavors\n      'citrus': ['sodastream-lemon-lime'],\n      'lemon': ['sodastream-lemon-lime'],\n      'lime': ['sodastream-lemon-lime'],\n      'fresh': ['sodastream-lemon-lime', 'monin-mint', 'monin-peppermint'],\n      \n      // Berry flavors\n      'raspberry': ['davinci-raspberry'],\n      'berry': ['davinci-raspberry', 'davinci-strawberry'],\n      'strawberry': ['davinci-strawberry'],\n      'tart': ['davinci-raspberry'],\n      'sweet': ['davinci-strawberry', 'davinci-watermelon'],\n      \n      // Tropical flavors\n      'tropical': ['monin-coconut'],\n      'coconut': ['monin-coconut'],\n      'summer': ['davinci-watermelon'],\n      'watermelon': ['davinci-watermelon'],\n      \n      // Nutty flavors\n      'hazelnut': ['torani-hazelnut'],\n      'nutty': ['torani-hazelnut'],\n      \n      // Mint flavors\n      'mint': ['monin-mint'],\n      'herbal': ['monin-mint'],\n      'cooling': ['monin-mint', 'monin-peppermint'],\n      'peppermint': ['monin-peppermint'],\n      'winter': ['monin-peppermint'],\n      \n      // Spice flavors\n      'spice': ['torani-pumpkin-spice'],\n      'pumpkin': ['torani-pumpkin-spice'],\n      'autumn': ['torani-pumpkin-spice'],\n      'warm': ['torani-pumpkin-spice']\n    };\n\n    for (const [flavor, syrupIds] of Object.entries(compatibilityRules)) {\n      this.compatibilityMatrix.set(flavor, new Map());\n      const flavorMap = this.compatibilityMatrix.get(flavor)!;\n      \n      syrupIds.forEach(syrupId => {\n        // Base compatibility score\n        let score = 80;\n        \n        // Adjust based on specific matches\n        if (flavor === syrupId.split('-')[1]) score = 95;\n        if (flavor === 'vanilla' && syrupId.includes('vanilla')) score = 95;\n        if (flavor === 'caramel' && syrupId.includes('caramel')) score = 95;\n        \n        flavorMap.set(syrupId, score);\n      });\n    }\n  }\n\n  /**\n   * Search and filter syrups based on criteria\n   * @param filter - Search and filter criteria\n   * @returns Filtered list of syrups\n   */\n  public searchSyrups(filter: SyrupMarketplaceFilter): PremadeSyrup[] {\n    let filteredSyrups = [...this.syrups];\n\n    // Apply brand filter\n    if (filter.brands && filter.brands.length > 0) {\n      filteredSyrups = filteredSyrups.filter(syrup => filter.brands!.includes(syrup.brand));\n    }\n\n    // Apply category filter\n    if (filter.categories && filter.categories.length > 0) {\n      filteredSyrups = filteredSyrups.filter(syrup => filter.categories!.includes(syrup.category));\n    }\n\n    // Apply concentration filter\n    if (filter.concentrations && filter.concentrations.length > 0) {\n      filteredSyrups = filteredSyrups.filter(syrup => filter.concentrations!.includes(syrup.concentration));\n    }\n\n    // Apply availability filter\n    if (filter.availability && filter.availability.length > 0) {\n      filteredSyrups = filteredSyrups.filter(syrup => filter.availability!.includes(syrup.availability));\n    }\n\n    // Apply rating filter\n    if (filter.rating) {\n      filteredSyrups = filteredSyrups.filter(syrup => \n        syrup.rating >= filter.rating!.min && syrup.rating <= filter.rating!.max\n      );\n    }\n\n    // Apply price filter\n    if (filter.priceRange) {\n      filteredSyrups = filteredSyrups.filter(syrup => {\n        const prices = Object.values(syrup.regionalPricing).map(pricing => pricing.price);\n        return prices.some(price => \n          price >= filter.priceRange!.min && price <= filter.priceRange!.max\n        );\n      });\n    }\n\n    // Apply search query\n    if (filter.searchQuery) {\n      const query = filter.searchQuery.toLowerCase();\n      filteredSyrups = filteredSyrups.filter(syrup => \n        syrup.name.toLowerCase().includes(query) ||\n        syrup.description.toLowerCase().includes(query) ||\n        syrup.tasteProfile.notes.some(note => note.toLowerCase().includes(query)) ||\n        syrup.brand.toLowerCase().includes(query)\n      );\n    }\n\n    // Apply sorting\n    filteredSyrups.sort((a, b) => {\n      let comparison = 0;\n      \n      switch (filter.sortBy) {\n        case 'price':\n          const aPrice = Math.min(...Object.values(a.regionalPricing).map(p => p.price));\n          const bPrice = Math.min(...Object.values(b.regionalPricing).map(p => p.price));\n          comparison = aPrice - bPrice;\n          break;\n        case 'rating':\n          comparison = a.rating - b.rating;\n          break;\n        case 'popularity':\n          comparison = a.reviewCount - b.reviewCount;\n          break;\n        case 'newest':\n          comparison = a.id.localeCompare(b.id);\n          break;\n      }\n      \n      return filter.sortOrder === 'desc' ? -comparison : comparison;\n    });\n\n    return filteredSyrups;\n  }\n\n  /**\n   * Get intelligent syrup recommendations for a target flavor\n   * @param targetFlavor - The flavor profile to match\n   * @param preferences - User preferences (budget, brand, etc.)\n   * @returns List of recommended syrups with compatibility scores\n   */\n  public getRecommendations(\n    targetFlavor: string, \n    preferences?: {\n      budget?: number;\n      brand?: string;\n      maxRating?: number;\n      availability?: string;\n    }\n  ): SyrupRecommendation[] {\n    const recommendations: SyrupRecommendation[] = [];\n    const compatibilityMap = this.compatibilityMatrix.get(targetFlavor);\n    \n    if (!compatibilityMap) {\n      return [];\n    }\n\n    for (const [syrupId, compatibilityScore] of compatibilityMap.entries()) {\n      const syrup = this.syrups.find(s => s.id === syrupId);\n      if (!syrup) continue;\n\n      // Apply preference filters\n      if (preferences?.brand && syrup.brand !== preferences.brand) continue;\n      if (preferences?.maxRating && syrup.rating > preferences.maxRating) continue;\n      if (preferences?.availability && syrup.availability !== preferences.availability) continue;\n      \n      if (preferences?.budget) {\n        const minPrice = Math.min(...Object.values(syrup.regionalPricing).map(p => p.price));\n        if (minPrice > preferences.budget) continue;\n      }\n\n      const minPrice = Math.min(...Object.values(syrup.regionalPricing).map(p => p.price));\n      const currency = Object.values(syrup.regionalPricing)[0].currency;\n      const pricePerMl = minPrice / 750; // Assuming 750ml bottles\n\n      recommendations.push({\n        syrup,\n        compatibilityScore,\n        reasons: this.generateRecommendationReasons(syrup, targetFlavor, compatibilityScore),\n        alternatives: this.getAlternatives(syrup, targetFlavor),\n        estimatedCost: {\n          amount: minPrice,\n          currency,\n          pricePerMl\n        },\n        availability: syrup.availability,\n        regionalAvailability: this.getRegionalAvailability(syrup)\n      });\n    }\n\n    return recommendations\n      .sort((a, b) => b.compatibilityScore - a.compatibilityScore)\n      .slice(0, 5); // Return top 5 recommendations\n  }\n\n  /**\n   * Generate human-readable reasons for syrup recommendations\n   */\n  private generateRecommendationReasons(\n    syrup: PremadeSyrup, \n    targetFlavor: string, \n    compatibilityScore: number\n  ): string[] {\n    const reasons: string[] = [];\n    \n    if (compatibilityScore >= 90) {\n      reasons.push(`Excellent match for ${targetFlavor} flavor profile`);\n    } else if (compatibilityScore >= 80) {\n      reasons.push(`Good compatibility with ${targetFlavor} flavors`);\n    } else {\n      reasons.push(`Compatible with ${targetFlavor} taste preferences`);\n    }\n    \n    if (syrup.rating >= 4.5) {\n      reasons.push(`Highly rated by users (${syrup.rating}/5 stars)`);\n    }\n    \n    if (syrup.reviewCount > 2000) {\n      reasons.push(`Popular choice with ${syrup.reviewCount.toLocaleString()} reviews`);\n    }\n    \n    const minPrice = Math.min(...Object.values(syrup.regionalPricing).map(p => p.price));\n    if (minPrice < 15) {\n      reasons.push('Good value for money');\n    }\n    \n    if (syrup.availability === 'in-stock') {\n      reasons.push('Currently available');\n    }\n    \n    return reasons;\n  }\n\n  /**\n   * Get alternative syrups for a given syrup\n   */\n  private getAlternatives(syrup: PremadeSyrup, targetFlavor: string): PremadeSyrup[] {\n    return this.syrups\n      .filter(other => \n        other.id !== syrup.id &&\n        other.category === syrup.category &&\n        other.concentration === syrup.concentration\n      )\n      .slice(0, 3);\n  }\n\n  /**\n   * Get regional availability information for a syrup\n   */\n  private getRegionalAvailability(syrup: PremadeSyrup): Record<string, PremadeSyrup['availability']> {\n    const availability: Record<string, PremadeSyrup['availability']> = {};\n    \n    Object.keys(syrup.regionalPricing).forEach(region => {\n      availability[region] = syrup.regionalPricing[region].availability;\n    });\n    \n    return availability;\n  }\n\n  /**\n   * Calculate cost comparison between DIY and premade approaches\n   */\n  public calculateCostComparison(\n    targetFlavor: string,\n    diyRecipe: {\n      ingredients: Array<{ id: string; amount: number; cost: number }>;\n      laborTime: number; // minutes\n      equipmentCost?: number;\n    }\n  ): CostComparison {\n    const recommendations = this.getRecommendations(targetFlavor);\n    const bestSyrup = recommendations[0]?.syrup;\n    \n    if (!bestSyrup) {\n      throw new Error(`No suitable syrup found for ${targetFlavor}`);\n    }\n\n    // DIY calculation\n    const diyIngredientCost = diyRecipe.ingredients.reduce((sum, ing) => sum + ing.cost, 0);\n    const diyLaborCost = (diyRecipe.laborTime / 60) * 15; // $15/hour\n    const diyEquipmentCost = diyRecipe.equipmentCost || 0;\n    const diyTotal = diyIngredientCost + diyLaborCost + diyEquipmentCost;\n    const diyCostPerServing = diyTotal / 20; // Assuming 20 servings\n\n    // Premade calculation\n    const syrupPrice = Math.min(...Object.values(bestSyrup.regionalPricing).map(p => p.price));\n    const premadeLaborCost = 5; // 5 minutes preparation\n    const premadeTotal = syrupPrice + premadeLaborCost;\n    const premadeCostPerServing = premadeTotal / 20;\n\n    // Hybrid calculation (syrup + custom additions)\n    const customAdditionsCost = 2; // Estimated cost for custom additions\n    const hybridTotal = syrupPrice + customAdditionsCost + premadeLaborCost;\n    const hybridCostPerServing = hybridTotal / 20;\n\n    const savings = diyTotal - premadeTotal;\n    const recommendation = savings > 0 ? 'premade' : 'diy';\n\n    return {\n      diy: {\n        ingredients: diyIngredientCost,\n        labor: diyLaborCost,\n        equipment: diyEquipmentCost,\n        total: diyTotal,\n        costPerServing: diyCostPerServing\n      },\n      premade: {\n        syrup: syrupPrice,\n        customAdditions: 0,\n        labor: premadeLaborCost,\n        total: premadeTotal,\n        costPerServing: premadeCostPerServing\n      },\n      hybrid: {\n        syrup: syrupPrice,\n        customAdditions: customAdditionsCost,\n        labor: premadeLaborCost,\n        total: hybridTotal,\n        costPerServing: hybridCostPerServing\n      },\n      savings,\n      recommendation,\n      qualityFactors: {\n        tasteMatch: recommendations[0]?.compatibilityScore || 70,\n        convenience: premadeTotal < diyTotal ? 90 : 60,\n        customization: diyTotal > premadeTotal ? 90 : 60,\n        freshness: diyTotal > premadeTotal ? 95 : 75\n      }\n    };\n  }\n\n  /**\n   * Get all available syrups\n   */\n  public getAllSyrups(): PremadeSyrup[] {\n    return [...this.syrups];\n  }\n\n  /**\n   * Get syrup by ID\n   */\n  public getSyrupById(id: string): PremadeSyrup | undefined {\n    return this.syrups.find(syrup => syrup.id === id);\n  }\n\n  /**\n   * Get brands list\n   */\n  public getBrands(): Array<PremadeSyrup['brand']> {\n    return [...new Set(this.syrups.map(syrup => syrup.brand))].sort();\n  }\n\n  /**\n   * Get categories list\n   */\n  public getCategories(): Array<PremadeSyrup['category']> {\n    return [...new Set(this.syrups.map(syrup => syrup.category))].sort();\n  }\n\n  /**\n   * Get concentrations list\n   */\n  public getConcentrations(): Array<PremadeSyrup['concentration']> {\n    return [...new Set(this.syrups.map(syrup => syrup.concentration))].sort();\n  }\n}"
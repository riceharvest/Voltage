/**
 * Dilution Guide System
 * 
 * Provides comprehensive dilution guides for commercial syrups with concentration-based
 * ratios, volume scaling, taste adjustment recommendations, and carbonation considerations.
 * Supports all major syrup types from concentrate to ready-to-drink formulations.
 * 
 * @example
 * ```typescript\n * import { DilutionGuideService } from './dilution-guides';\n * \n * const dilutionService = new DilutionGuideService();\n * const guide = await dilutionService.getDilutionGuide('torani-vanilla', '1L');\n * console.log(guide.instructions);\n * ```\n */\n\nimport { DilutionGuide, PremadeSyrup } from './types';\n\n/**\n * Dilution Guide Service\n * \n * Central service for managing syrup dilution guides, scaling calculations,\n * and taste optimization recommendations.\n */\nexport class DilutionGuideService {\n  private dilutionTemplates: Map<string, DilutionGuide> = new Map();\n  \n  constructor() {\n    this.initializeDilutionTemplates();\n  }\n\n  /**\n   * Initialize comprehensive dilution guide templates for different syrup types\n   */\n  private initializeDilutionTemplates(): void {\n    // CONCENTRATE TEMPLATES (1:1 dilution)\n    this.dilutionTemplates.set('concentrate-strong', {\n      syrupType: 'concentrate',\n      concentration: '1:1',\n      targetStrength: 'strong',\n      instructions: [\n        'Mix 1 part syrup with 1 part water for maximum flavor intensity',\n        'Use filtered or still water for best results',\n        'Stir gently to avoid creating foam',\n        'Taste and adjust sweetness as needed'\n      ],\n      batchScaling: {\n        '250ml': { syrup: '125ml', water: '125ml' },\n        '500ml': { syrup: '250ml', water: '250ml' },\n        '1L': { syrup: '500ml', water: '500ml' },\n        '2L': { syrup: '1L', water: '1L' }\n      },\n      tasteAdjustments: {\n        tooSweet: ['Add 10-20% more water', 'Add a splash of lemon juice for brightness'],\n        tooWeak: ['Use 20% less water', 'Add 2-3 drops of syrup concentrate'],\n        tooStrong: ['Add 25% more water', 'Mix with sparkling water for carbonation']\n      },\n      carbonationNotes: 'Add carbonation after mixing for sparkling versions. Use 2-3 bars pressure.',\n      storageTips: [\n        'Refrigerate after opening',\n        'Use clean, dry utensils when handling',\n        'Consume within 6-12 months of opening'\n      ]\n    });\n\n    this.dilutionTemplates.set('concentrate-medium', {\n      syrupType: 'concentrate',\n      concentration: '1:1',\n      targetStrength: 'medium',\n      instructions: [\n        'Mix 1 part syrup with 2 parts water for balanced flavor',\n        'Use room temperature water for better dissolution',\n        'Allow mixture to rest for 2-3 minutes before serving',\n        'Taste and fine-tune with additional water if needed'\n      ],\n      batchScaling: {\n        '250ml': { syrup: '83ml', water: '167ml' },\n        '500ml': { syrup: '167ml', water: '333ml' },\n        '1L': { syrup: '333ml', water: '667ml' },\n        '2L': { syrup: '667ml', water: '1.33L' }\n      },\n      tasteAdjustments: {\n        tooSweet: ['Add 15-25% more water', 'Add ice to dilute as it melts'],\n        tooWeak: ['Use 10% less water', 'Add 1-2 drops of syrup concentrate'],\n        tooStrong: ['Add 20% more water', 'Mix with carbonated water for sparkle']\n      },\n      carbonationNotes: 'Perfect for both still and sparkling drinks. Add carbonation last.',\n      storageTips: [\n        'Store in refrigerator after mixing',\n        'Use within 24-48 hours for best quality',\n        'Shake gently before serving if separated'\n      ]\n    });\n\n    this.dilutionTemplates.set('concentrate-light', {\n      syrupType: 'concentrate',\n      concentration: '1:1',\n      targetStrength: 'light',\n      instructions: [\n        'Mix 1 part syrup with 3-4 parts water for subtle flavor',\n        'Perfect for large gatherings or all-day sipping',\n        'Start with 3:1 ratio and adjust to taste',\n        'Add ice cubes to maintain flavor concentration'\n      ],\n      batchScaling: {\n        '250ml': { syrup: '62ml', water: '188ml' },\n        '500ml': { syrup: '125ml', water: '375ml' },\n        '1L': { syrup: '250ml', water: '750ml' },\n        '2L': { syrup: '500ml', water: '1.5L' }\n      },\n      tasteAdjustments: {\n        tooSweet: ['Add 25-30% more water', 'Mix with sparkling water'],\n        tooWeak: ['Use 15% less water', 'Add 1 drop of syrup per glass'],\n        tooStrong: ['Add 30% more water', 'Serve over more ice']\n      },\n      carbonationNotes: 'Excellent for sparkling waters and club soda. Add carbonation for refreshing effect.',\n      storageTips: [\n        'Can be prepared in large batches',\n        'Store covered in refrigerator',\n        'Remains stable for 3-5 days'\n      ]\n    });\n\n    // READY-TO-DRINK TEMPLATES (1:0 dilution)\n    this.dilutionTemplates.set('ready-to-drink', {\n      syrupType: 'ready-to-drink',\n      concentration: '1:0',\n      targetStrength: 'medium',\n      instructions: [\n        'Ready-to-drink syrups require no dilution',\n        'Can be mixed with water for lighter versions if desired',\n        'Perfect for coffee drinks, desserts, and direct consumption',\n        'Can be used as topping or drizzle'\n      ],\n      batchScaling: {\n        '250ml': { syrup: '250ml', water: '0ml' },\n        '500ml': { syrup: '500ml', water: '0ml' },\n        '1L': { syrup: '1L', water: '0ml' },\n        '2L': { syrup: '2L', water: '0ml' }\n      },\n      tasteAdjustments: {\n        tooSweet: ['Mix with 25-50% water', 'Add to coffee or milk to dilute'],\n        tooWeak: ['Use undiluted', 'Add concentrated drops for enhancement'],\n        tooStrong: ['Mix with equal parts water', 'Use as topping instead of base']\n      },\n      carbonationNotes: 'Not typically carbonated, but can be mixed with sparkling beverages.',\n      storageTips: [\n        'Store according to package directions',\n        'May require refrigeration after opening',\n        'Check expiration dates regularly'\n      ]\n    });\n\n    // POWDER TEMPLATES\n    this.dilutionTemplates.set('powder', {\n      syrupType: 'powder',\n      concentration: '1:8',\n      targetStrength: 'medium',\n      instructions: [\n        'Mix 1 part powder with 8 parts hot water for best dissolution',\n        'Stir thoroughly until completely dissolved',\n        'Add cold water and ice to cool to serving temperature',\n        'Allow 5-10 minutes for full flavor development'\n      ],\n      batchScaling: {\n        '250ml': { syrup: '28ml', water: '222ml' },\n        '500ml': { syrup: '56ml', water: '444ml' },\n        '1L': { syrup: '111ml', water: '889ml' },\n        '2L': { syrup: '222ml', water: '1.78L' }\n      },\n      tasteAdjustments: {\n        tooSweet: ['Add 10-20% more water', 'Mix with carbonated water'],\n        tooWeak: ['Use 10-15% less water', 'Add 1/4 tsp more powder per liter'],\n        tooStrong: ['Add 15-25% more water', 'Mix with ice for dilution']\n      },\n      carbonationNotes: 'Best as still drink, but can be carbonated after mixing if desired.',\n      storageTips: [\n        'Keep powder in airtight container',\n        'Use within 6 months of opening',\n        'Store in cool, dry place'\n      ]\n    });\n\n    // HIGH CONCENTRATE TEMPLATES\n    this.dilutionTemplates.set('concentrate-extreme', {\n      syrupType: 'concentrate',\n      concentration: '1:16',\n      targetStrength: 'very-light',\n      instructions: [\n        'Mix 1 part syrup with 16 parts water for very light flavor',\n        'Perfect for large batches and refreshment',\n        'Excellent for hydrating while adding subtle flavor',\n        'Ideal for sports drinks and all-day consumption'\n      ],\n      batchScaling: {\n        '250ml': { syrup: '15ml', water: '235ml' },\n        '500ml': { syrup: '29ml', water: '471ml' },\n        '1L': { syrup: '59ml', water: '941ml' },\n        '2L': { syrup: '118ml', water: '1.88L' }\n      },\n      tasteAdjustments: {\n        tooSweet: ['Add 20-30% more water', 'Serve over ice'],\n        tooWeak: ['Use 15% less water', 'Add 2-3 drops of syrup'],\n        tooStrong: ['Add 25% more water', 'Mix with sparkling water']\n      },\n      carbonationNotes: 'Perfect base for sparkling beverages and club soda enhancements.',\n      storageTips: [\n        'Prepare large batches efficiently',\n        'Store covered and chilled',\n        'Remains fresh for 3-5 days'\n      ]\n    });\n  }\n\n  /**\n   * Get dilution guide for a specific syrup and batch size\n   * @param syrup - The syrup to create dilution guide for\n   * @param batchSize - Target batch size in ml\n   * @param targetStrength - Desired flavor intensity\n   * @returns Complete dilution guide with instructions\n   */\n  public getDilutionGuide(\n    syrup: PremadeSyrup,\n    batchSize: string = '1L',\n    targetStrength?: DilutionGuide['targetStrength']\n  ): DilutionGuide {\n    const templateKey = this.getTemplateKey(syrup.concentration, targetStrength);\n    const template = this.dilutionTemplates.get(templateKey);\n    \n    if (!template) {\n      throw new Error(`No dilution template found for ${syrup.concentration} concentration`);\n    }\n\n    // Create customized guide based on syrup properties\n    const customizedGuide: DilutionGuide = {\n      ...template,\n      syrupType: syrup.concentration,\n      concentration: syrup.dilutionRatio\n    };\n\n    // Add syrup-specific instructions\n    customizedGuide.instructions = [\n      ...customizedGuide.instructions,\n      `Use ${syrup.usageGuide.recommendedRatio} ratio as recommended by ${syrup.brand}`,\n      `Maximum daily intake: ${syrup.usageGuide.maxDaily}ml`,\n      `Storage: ${syrup.usageGuide.storage}`\n    ];\n\n    // Add brand-specific storage tips\n    customizedGuide.storageTips = [\n      ...customizedGuide.storageTips,\n      `Shelf life: ${syrup.usageGuide.shelfLife}`,\n      syrup.availability === 'limited' ? 'Note: Limited availability - consider bulk purchase' : ''\n    ].filter(Boolean);\n\n    // Calculate exact measurements for requested batch size\n    const measurements = this.calculateBatchMeasurements(\n      syrup.dilutionRatio,\n      batchSize\n    );\n\n    customizedGuide.batchScaling[batchSize] = measurements;\n\n    return customizedGuide;\n  }\n\n  /**\n   * Calculate precise measurements for batch scaling\n   */\n  private calculateBatchMeasurements(\n    dilutionRatio: string,\n    batchSize: string\n  ): { syrup: string; water: string } {\n    const sizeMl = this.parseBatchSize(batchSize);\n    const [syrupRatio, waterRatio] = dilutionRatio.split(':').map(Number);\n    const totalRatio = syrupRatio + waterRatio;\n    \n    const syrupAmount = (sizeMl * syrupRatio) / totalRatio;\n    const waterAmount = (sizeMl * waterRatio) / totalRatio;\n\n    return {\n      syrup: `${Math.round(syrupAmount)}ml`,\n      water: `${Math.round(waterAmount)}ml`\n    };\n  }\n\n  /**\n   * Parse batch size string to numeric value in ml\n   */\n  private parseBatchSize(batchSize: string): number {\n    const size = batchSize.toLowerCase();\n    const match = size.match(/(\\d+)([ml]|l)/);\n    \n    if (!match) {\n      throw new Error(`Invalid batch size: ${batchSize}`);\n    }\n    \n    const amount = parseInt(match[1]);\n    const unit = match[2];\n    \n    if (unit === 'l') {\n      return amount * 1000;\n    }\n    \n    return amount;\n  }\n\n  /**\n   * Get template key based on syrup concentration and target strength\n   */\n  private getTemplateKey(\n    concentration: PremadeSyrup['concentration'],\n    targetStrength?: DilutionGuide['targetStrength']\n  ): string {\n    const strength = targetStrength || 'medium';\n    \n    switch (concentration) {\n      case 'concentrate':\n        if (strength === 'very-strong' || strength === 'strong') return 'concentrate-strong';\n        if (strength === 'very-light' || strength === 'light') return 'concentrate-light';\n        return 'concentrate-medium';\n      \n      case 'ready-to-drink':\n        return 'ready-to-drink';\n      \n      case 'powder':\n        return 'powder';\n      \n      case 'liquid':\n        return 'concentrate-medium';\n      \n      default:\n        return 'concentrate-medium';\n    }\n  }\n\n  /**\n   * Get dilution recommendations based on syrup type and use case\n   * @param syrup - The syrup to analyze\n   * @param useCase - Intended use case (coffee, soda, dessert, etc.)\n   * @returns Array of dilution recommendations\n   */\n  public getDilutionRecommendations(\n    syrup: PremadeSyrup,\n    useCase: 'coffee' | 'soda' | 'dessert' | 'beverage' | 'cocktail'\n  ): Array<{\n    name: string;\n    ratio: string;\n    description: string;\n    strength: DilutionGuide['targetStrength'];\n  }> {\n    const recommendations = [];\n\n    switch (useCase) {\n      case 'coffee':\n        recommendations.push(\n          {\n            name: 'Coffee Enhancement',\n            ratio: '1:2',\n            description: 'Perfect for coffee drinks and lattes',\n            strength: 'medium' as DilutionGuide['targetStrength']\n          },\n          {\n            name: 'Coffee Drizzle',\n            ratio: '1:1',\n            description: 'Concentrated for topping and drizzling',\n            strength: 'strong' as DilutionGuide['targetStrength']\n          }\n        );\n        break;\n\n      case 'soda':\n        recommendations.push(\n          {\n            name: 'Light & Refreshing',\n            ratio: '1:4',\n            description: 'Light, refreshing soda drink',\n            strength: 'light' as DilutionGuide['targetStrength']\n          },\n          {\n            name: 'Classic Soda',\n            ratio: '1:3',\n            description: 'Traditional soda flavor intensity',\n            strength: 'medium' as DilutionGuide['targetStrength']\n          },\n          {\n            name: 'Strong & Bold',\n            ratio: '1:2',\n            description: 'Bold flavor for concentration',\n            strength: 'strong' as DilutionGuide['targetStrength']\n          }\n        );\n        break;\n\n      case 'dessert':\n        recommendations.push(\n          {\n            name: 'Light Dessert',\n            ratio: '1:1',\n            description: 'Balanced sweetness for desserts',\n            strength: 'medium' as DilutionGuide['targetStrength']\n          },\n          {\n            name: 'Concentrated Topping',\n            ratio: '1:0.5',\n            description: 'Concentrated for drizzling and topping',\n            strength: 'very-strong' as DilutionGuide['targetStrength']\n          }\n        );\n        break;\n\n      case 'beverage':\n        recommendations.push(\n          {\n            name: 'Light Beverage',\n            ratio: '1:6',\n            description: 'Subtle flavor for all-day sipping',\n            strength: 'very-light' as DilutionGuide['targetStrength']\n          },\n          {\n            name: 'Regular Beverage',\n            ratio: '1:3',\n            description: 'Standard beverage flavor',\n            strength: 'medium' as DilutionGuide['targetStrength']\n          }\n        );\n        break;\n\n      case 'cocktail':\n        recommendations.push(\n          {\n            name: 'Cocktail Base',\n            ratio: '1:2',\n            description: 'Perfect for mixed drinks',\n            strength: 'medium' as DilutionGuide['targetStrength']\n          },\n          {\n            name: 'Cocktail Concentrate',\n            ratio: '1:1',\n            description: 'Strong flavor for mixing',\n            strength: 'strong' as DilutionGuide['targetStrength']\n          }\n        );\n        break;\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Calculate carbonation recommendations for syrup mixing\n   * @param syrup - The syrup to analyze\n   * @param batchSize - Target batch size\n   * @returns Carbonation guidance\n   */\n  public getCarbonationGuide(\n    syrup: PremadeSyrup,\n    batchSize: string = '1L'\n  ): {\n    recommended: boolean;\n    carbonationLevel: string;\n    timing: 'before' | 'after' | 'during';\n    pressure: string;\n    notes: string[];\n  } {\n    const sizeMl = this.parseBatchSize(batchSize);\n    const category = syrup.category;\n    \n    let recommended = true;\n    let carbonationLevel = 'medium';\n    let timing: 'before' | 'after' | 'during' = 'after';\n    let pressure = '2-3 bars';\n    const notes: string[] = [];\n\n    // Category-specific recommendations\n    switch (category) {\n      case 'flavor':\n        if (syrup.name.toLowerCase().includes('cream') || syrup.name.toLowerCase().includes('vanilla')) {\n          recommended = false;\n          notes.push('Cream-based syrups don\\'t carbonate well');\n        }\n        break;\n      \n      case 'fruit':\n        carbonationLevel = 'high';\n        pressure = '3-4 bars';\n        notes.push('Fruit flavors benefit from extra carbonation');\n        break;\n      \n      case 'coffee':\n        carbonationLevel = 'low';\n        pressure = '1-2 bars';\n        timing = 'during';\n        notes.push('Coffee syrups should be carbonated during mixing');\n        break;\n      \n      case 'spice':\n        carbonationLevel = 'medium';\n        timing = 'after';\n        notes.push('Spice flavors work well with medium carbonation');\n        break;\n    }\n\n    // Sweetness-based adjustments\n    if (syrup.tasteProfile.sweetness === 'very-high') {\n      notes.push('High sweetness may reduce perceived carbonation');\n    }\n\n    // Brand-specific notes\n    if (syrup.brand === 'SodaStream') {\n      notes.push('Optimized for SodaStream carbonation systems');\n      timing = 'during';\n    }\n\n    return {\n      recommended,\n      carbonationLevel,\n      timing,\n      pressure,\n      notes\n    };\n  }\n\n  /**\n   * Generate taste adjustment suggestions for over/under-diluted drinks\n   * @param syrup - The syrup being used\n   * @param issue - The taste issue to fix\n   * @param currentRatio - Current dilution ratio\n   * @returns Array of adjustment suggestions\n   */\n  public getTasteAdjustments(\n    syrup: PremadeSyrup,\n    issue: 'too-sweet' | 'too-weak' | 'too-strong' | 'too-bitter' | 'too-acidic',\n    currentRatio: string\n  ): Array<{\n    type: 'dilution' | 'concentration' | 'additive' | 'mixing';\n    action: string;\n    amount: string;\n    explanation: string;\n  }> {\n    const adjustments = [];\n\n    switch (issue) {\n      case 'too-sweet':\n        if (syrup.tasteProfile.sweetness === 'very-high') {\n          adjustments.push(\n            {\n              type: 'dilution' as const,\n              action: 'Add more water',\n              amount: '10-20%',\n              explanation: 'Reduce overall sweetness by increasing water ratio'\n            },\n            {\n              type: 'additive' as const,\n              action: 'Add lemon or lime juice',\n              amount: '1-2 tsp per liter',\n              explanation: 'Citrus acids balance sweetness naturally'\n            },\n            {\n              type: 'mixing' as const,\n              action: 'Mix with carbonated water',\n              amount: '25-50%',\n              explanation: 'Carbonation enhances perception of less sweetness'\n            }\n          );\n        } else {\n          adjustments.push(\n            {\n              type: 'dilution' as const,\n              action: 'Add water',\n              amount: '15-25%',\n              explanation: 'Standard dilution to reduce sweetness'\n            }\n          );\n        }\n        break;\n\n      case 'too-weak':\n        adjustments.push(\n          {\n            type: 'concentration' as const,\n            action: 'Reduce water ratio',\n            amount: '10-15%',\n            explanation: 'Increase syrup concentration for stronger flavor'\n          },\n          {\n            type: 'additive' as const,\n            action: 'Add syrup drops',\n            amount: '2-3 drops per glass',\n            explanation: 'Pure syrup concentrate for flavor boost'\n          },\n          {\n            type: 'mixing' as const,\n            action: 'Use less ice',\n            amount: '25% less',\n              explanation: 'Reduce dilution from melting ice'\n          }\n        );\n        break;\n\n      case 'too-strong':\n        adjustments.push(\n          {\n            type: 'dilution' as const,\n            action: 'Add water',\n            amount: '20-30%',\n            explanation: 'Significant dilution to reduce intensity'\n          },\n          {\n            type: 'mixing' as const,\n            action: 'Add ice cubes',\n            amount: 'Generous amount',\n            explanation: 'Ice both cools and dilutes the drink'\n          },\n          {\n            type: 'mixing' as const,\n            action: 'Mix with sparkling water',\n            amount: 'Equal parts',\n            explanation: 'Carbonation masks strong flavors'\n          }\n        );\n        break;\n\n      case 'too-bitter':\n        adjustments.push(\n          {\n            type: 'additive' as const,\n            action: 'Add simple syrup or honey',\n            amount: '1 tsp per liter',\n            explanation: 'Sweeteners balance bitter notes'\n          },\n          {\n            type: 'dilution' as const,\n            action: 'Add water',\n            amount: '15%',\n            explanation: 'Dilution reduces bitter intensity'\n          }\n        );\n        break;\n\n      case 'too-acidic':\n        adjustments.push(\n          {\n            type: 'additive' as const,\n            action: 'Add baking soda',\n            amount: '1/4 tsp per liter',\n            explanation: 'Alkali neutralizes acidity'\n          },\n          {\n            type: 'dilution' as const,\n            action: 'Add water',\n            amount: '20%',\n            explanation: 'Water dilutes acidic components'\n          }\n        );\n        break;\n    }\n\n    return adjustments;\n  }\n\n  /**\n   * Get storage and shelf life recommendations for prepared syrups\n   * @param syrup - The syrup being used\n   * @param preparedAmount - Amount prepared (in ml)\n   * @returns Storage recommendations\n   */\n  public getStorageRecommendations(\n    syrup: PremadeSyrup,\n    preparedAmount: number\n  ): {\n    storageMethod: string;\n    temperature: string;\n    duration: string;\n    signsOfSpoilage: string[];\n    preservationTips: string[];\n  } {\n    let storageMethod = 'refrigerate';\n    let temperature = '4°C (39°F)';\n    let duration = '3-5 days';\n    const signsOfSpoilage: string[] = [\n      'Off smell or unusual odor',\n      'Cloudy appearance',\n      'Separation that doesn\\'t mix when shaken',\n      'Mold growth',\n      'Unusual taste or aftertaste'\n    ];\n    const preservationTips: string[] = [\n      'Use clean, sanitized containers',\n      'Keep refrigerated at all times',\n      'Use clean utensils when handling',\n      'Cover container tightly when not in use'\n    ];\n\n    // Adjust based on syrup type and preparation\n    if (syrup.concentration === 'concentrate') {\n      if (preparedAmount < 100) {\n        duration = '1-2 days';\n        preservationTips.push('Small amounts spoil faster due to increased surface area');\n      } else {\n        duration = '5-7 days';\n      }\n    } else if (syrup.concentration === 'ready-to-drink') {\n      duration = '7-10 days';\n      temperature = 'Room temperature or refrigerated';\n    }\n\n    // Add brand-specific recommendations\n    if (syrup.brand === 'Monin') {\n      preservationTips.push('Monin syrups have natural preservatives');\n    }\n    if (syrup.brand === 'Torani') {\n      preservationTips.push('Torani recommends refrigeration after opening');\n    }\n\n    return {\n      storageMethod,\n      temperature,\n      duration,\n      signsOfSpoilage,\n      preservationTips\n    };\n  }\n\n  /**\n   * Calculate nutritional information for diluted syrup\n   * @param syrup - The syrup being used\n   * @param ratio - Dilution ratio\n   * @param servingSize - Serving size in ml\n   * @returns Nutritional information per serving\n   */\n  public calculateNutritionalInfo(\n    syrup: PremadeSyrup,\n    ratio: string,\n    servingSize: number\n  ): {\n    calories: number;\n    sugar: number;\n    caffeine: number;\n    sodium: number;\n    disclaimer: string;\n  } {\n    const [syrupPart, waterPart] = ratio.split(':').map(Number);\n    const totalParts = syrupPart + waterPart;\n    const syrupRatio = syrupPart / totalParts;\n    \n    const syrupInServing = (servingSize * syrupRatio) / 1000; // Convert to liters\n    \n    // Estimated nutritional values based on syrup type\n    let baseCaloriesPerLiter = 400;\n    let baseSugarPerLiter = 100; // grams\n    let baseCaffeinePerLiter = 0; // mg\n    let baseSodiumPerLiter = 50; // mg\n\n    // Adjust based on syrup category and brand\n    if (syrup.category === 'cream') {\n      baseCaloriesPerLiter = 600;\n      baseSugarPerLiter = 150;\n    }\n    \n    if (syrup.brand === 'Jordan\\'s Skinny' || syrup.name.toLowerCase().includes('sugar-free')) {\n      baseCaloriesPerLiter = 50;\n      baseSugarPerLiter = 5;\n    }\n\n    // Calculate per serving values\n    const calories = Math.round((baseCaloriesPerLiter * syrupInServing) * 10) / 10;\n    const sugar = Math.round((baseSugarPerLiter * syrupInServing) * 10) / 10;\n    const caffeine = Math.round(baseCaffeinePerLiter * syrupInServing);\n    const sodium = Math.round((baseSodiumPerLiter * syrupInServing) * 10) / 10;\n\n    return {\n      calories,\n      sugar,\n      caffeine,\n      sodium,\n      disclaimer: 'Nutritional values are estimates based on syrup type. Actual values may vary by brand and recipe.'\n    };\n  }\n}"
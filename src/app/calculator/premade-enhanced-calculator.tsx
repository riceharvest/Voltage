/**
 * Enhanced Calculator with Premade Mode Integration
 * 
 * Advanced calculator that supports DIY, Premade, and Hybrid modes with
 * comprehensive cost analysis, syrup recommendations, and preparation guidance.
 * 
 * @example
 * ```tsx
 * import { PremadeEnhancedCalculator } from './premade-enhanced-calculator';
 * 
 * export default function CalculatorPage() {
 *   return <PremadeEnhancedCalculator />;
 * }
 * ```
 */\n\n'use client';\n\nimport React, { useState, useMemo, useEffect } from 'react';\nimport { \n  Calculator, \n  ShieldCheck, \n  Settings, \n  DollarSign, \n  Clock, \n  Zap, \n  ChefHat, \n  Coffee, \n  Home,\n  TrendingUp,\n  Award,\n  Star,\n  Package,\n  BarChart3,\n  RefreshCw,\n  ArrowRight,\n  CheckCircle,\n  AlertCircle,\n  Info\n} from 'lucide-react';\nimport { \n  FlavorRecipe, \n  PremadeMode, \n  PremadeSyrup, \n  CostComparison,\n  SyrupRecommendation,\n  ComprehensiveCostAnalysis\n} from '@/lib/types';\nimport { PremadeSyrupService } from '@/lib/premade-syrups';\nimport { DilutionGuideService } from '@/lib/dilution-guides';\nimport { HybridRecipeService } from '@/lib/hybrid-recipes';\nimport { PremadeCostAnalysis } from '@/lib/premade-cost-analysis';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Progress } from '@/components/ui/progress';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\n\n/**\n * Enhanced Calculator Props\n */\ninterface PremadeEnhancedCalculatorProps {\n  initialMode?: 'diy' | 'premade' | 'hybrid';\n  region?: string;\n  currency?: string;\n  onRecipeGenerated?: (recipe: any) => void;\n}\n\n/**\n * Premade Mode Selection Component\n */\nconst PremadeModeSelector: React.FC<{\n  mode: 'diy' | 'premade' | 'hybrid';\n  onModeChange: (mode: 'diy' | 'premade' | 'hybrid') => void;\n}> = ({ mode, onModeChange }) => {\n  const modes = [\n    {\n      id: 'diy' as const,\n      name: 'DIY Recipe',\n      description: 'Traditional homemade approach with full control',\n      icon: ChefHat,\n      benefits: ['Complete ingredient control', 'Freshest results', 'Customizable'],\n      timeEstimate: '25-30 min',\n      difficulty: 'Intermediate',\n      color: 'from-blue-500 to-blue-600'\n    },\n    {\n      id: 'premade' as const,\n      name: 'Premade Syrups',\n      description: 'Commercial syrups for quick and consistent results',\n      icon: Coffee,\n      benefits: ['5-minute prep', 'Consistent quality', 'Wide variety'],\n      timeEstimate: '5 min',\n      difficulty: 'Easy',\n      color: 'from-green-500 to-green-600'\n    },\n    {\n      id: 'hybrid' as const,\n      name: 'Hybrid Mode',\n      description: 'Best of both worlds - syrups + custom enhancements',\n      icon: Home,\n      benefits: ['Balanced approach', 'Enhanced flavors', 'Cost effective'],\n      timeEstimate: '12-15 min',\n      difficulty: 'Moderate',\n      color: 'from-purple-500 to-purple-600'\n    }\n  ];\n\n  return (\n    <div className=\"space-y-4\">\n      <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Choose Your Preparation Mode</h3>\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        {modes.map((modeOption) => {\n          const Icon = modeOption.icon;\n          const isSelected = mode === modeOption.id;\n          \n          return (\n            <Card \n              key={modeOption.id}\n              className={`cursor-pointer transition-all duration-200 ${\n                isSelected \n                  ? 'ring-2 ring-primary border-primary shadow-lg transform scale-105' \n                  : 'hover:shadow-md hover:border-gray-300'\n              }`}\n              onClick={() => onModeChange(modeOption.id)}\n            >\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className={`p-2 rounded-lg bg-gradient-to-r ${modeOption.color} text-white`}>\n                    <Icon className=\"h-5 w-5\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <CardTitle className=\"text-base\">{modeOption.name}</CardTitle>\n                    <CardDescription className=\"text-sm\">\n                      {modeOption.description}\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"pt-0\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between text-xs\">\n                    <div className=\"flex items-center space-x-1\">\n                      <Clock className=\"h-3 w-3\" />\n                      <span>{modeOption.timeEstimate}</span>\n                    </div>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {modeOption.difficulty}\n                    </Badge>\n                  </div>\n                  \n                  <div className=\"space-y-1\">\n                    {modeOption.benefits.map((benefit, index) => (\n                      <div key={index} className=\"flex items-center space-x-2 text-xs text-gray-600\">\n                        <CheckCircle className=\"h-3 w-3 text-green-500\" />\n                        <span>{benefit}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Syrup Recommendation Display Component\n */\nconst SyrupRecommendationCard: React.FC<{\n  recommendation: SyrupRecommendation;\n  onSelect: (syrup: PremadeSyrup) => void;\n}> = ({ recommendation, onSelect }) => {\n  const { syrup, compatibilityScore, reasons, estimatedCost } = recommendation;\n  \n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <CardTitle className=\"text-lg font-semibold text-gray-900 line-clamp-2\">\n              {syrup.name}\n            </CardTitle>\n            <CardDescription className=\"text-sm text-gray-600 mt-1\">\n              {syrup.brand} • {syrup.category}\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center space-x-1\">\n            <Star className=\"h-4 w-4 text-yellow-400 fill-current\" />\n            <span className=\"text-sm font-medium\">{syrup.rating.toFixed(1)}</span>\n          </div>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"flex-1 flex flex-col space-y-4\">\n        {/* Compatibility Score */}\n        <div>\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm font-medium text-gray-700\">Compatibility</span>\n            <span className=\"text-sm font-bold text-green-600\">{compatibilityScore}%</span>\n          </div>\n          <Progress value={compatibilityScore} className=\"h-2\" />\n        </div>\n        \n        {/* Taste Profile */}\n        <div>\n          <div className=\"text-sm font-medium text-gray-700 mb-2\">Flavor Profile</div>\n          <div className=\"flex flex-wrap gap-1\">\n            {syrup.tasteProfile.notes.slice(0, 4).map((note, index) => (\n              <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                {note}\n              </Badge>\n            ))}\n          </div>\n        </div>\n        \n        {/* Pricing */}\n        <div className=\"bg-gray-50 rounded-lg p-3\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm font-medium text-gray-700\">Estimated Cost</span>\n            <span className=\"text-lg font-bold text-gray-900\">\n              {estimatedCost.currency} {estimatedCost.amount.toFixed(2)}\n            </span>\n          </div>\n          <div className=\"text-xs text-gray-500\">\n            €{estimatedCost.pricePerMl.toFixed(3)}/ml • {syrup.dilutionRatio} dilution\n          </div>\n        </div>\n        \n        {/* Reasons */}\n        <div>\n          <div className=\"text-sm font-medium text-gray-700 mb-2\">Why this syrup?</div>\n          <div className=\"space-y-1\">\n            {reasons.slice(0, 3).map((reason, index) => (\n              <div key={index} className=\"flex items-start space-x-2 text-xs text-gray-600\">\n                <CheckCircle className=\"h-3 w-3 text-green-500 mt-0.5 flex-shrink-0\" />\n                <span>{reason}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n        \n        <Button \n          onClick={() => onSelect(syrup)}\n          className=\"mt-auto w-full\"\n          disabled={syrup.availability === 'out-of-stock'}\n        >\n          {syrup.availability === 'out-of-stock' ? 'Out of Stock' : 'Select This Syrup'}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n\n/**\n * Cost Analysis Display Component\n */\nconst CostAnalysisDisplay: React.FC<{\n  analysis: ComprehensiveCostAnalysis;\n}> = ({ analysis }) => {\n  const { diy, premade, hybrid, recommendation, qualityAssessment } = analysis;\n  \n  return (\n    <div className=\"space-y-6\">\n      {/* Cost Comparison Chart */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center space-x-2\">\n            <BarChart3 className=\"h-5 w-5\" />\n            <span>Cost Comparison</span>\n          </CardTitle>\n          <CardDescription>\n            Detailed breakdown of costs for different preparation methods\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {[\n              { \n                mode: 'DIY', \n                cost: diy.totalCost, \n                perServing: diy.costPerServing, \n                color: 'bg-blue-500',\n                textColor: 'text-blue-600'\n              },\n              { \n                mode: 'Premade', \n                cost: premade.totalCost, \n                perServing: premade.costPerServing, \n                color: 'bg-green-500',\n                textColor: 'text-green-600'\n              },\n              { \n                mode: 'Hybrid', \n                cost: hybrid.totalCost, \n                perServing: hybrid.costPerServing, \n                color: 'bg-purple-500',\n                textColor: 'text-purple-600'\n              }\n            ].map((item) => {\n              const maxCost = Math.max(diy.totalCost, premade.totalCost, hybrid.totalCost);\n              const percentage = (item.cost / maxCost) * 100;\n              \n              return (\n                <div key={item.mode} className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium text-gray-700\">{item.mode}</span>\n                    <div className=\"text-right\">\n                      <div className={`font-bold ${item.textColor}`}>\n                        €{item.cost.toFixed(2)}\n                      </div>\n                      <div className=\"text-xs text-gray-500\">\n                        €{item.perServing.toFixed(2)} per serving\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                    <div \n                      className={`h-2 rounded-full ${item.color}`}\n                      style={{ width: `${percentage}%` }}\n                    />\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n      \n      {/* Quality Assessment */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center space-x-2\">\n            <Award className=\"h-5 w-5\" />\n            <span>Quality Assessment</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {Object.entries(qualityAssessment).map(([mode, assessment]) => (\n              <div key={mode} className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-medium text-gray-700 capitalize\">{mode}</span>\n                  <div className=\"flex items-center space-x-2\">\n                    <span className=\"text-sm font-bold text-gray-900\">\n                      {assessment.overallRating.toFixed(0)}/100\n                    </span>\n                    <Badge \n                      variant={assessment.recommendation.includes('recommended') ? 'default' : 'secondary'}\n                      className=\"text-xs\"\n                    >\n                      {assessment.recommendation.replace('-', ' ')}\n                    </Badge>\n                  </div>\n                </div>\n                <Progress value={assessment.overallRating} className=\"h-2\" />\n                \n                <div className=\"grid grid-cols-2 gap-4 mt-3 text-xs\">\n                  <div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Taste</span>\n                      <span>{assessment.tasteScore}/100</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Convenience</span>\n                      <span>{assessment.convenienceScore}/100</span>\n                    </div>\n                  </div>\n                  <div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Freshness</span>\n                      <span>{assessment.freshnessScore}/100</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Consistency</span>\n                      <span>{assessment.consistencyScore}/100</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n      \n      {/* Recommendation */}\n      <Alert>\n        <TrendingUp className=\"h-4 w-4\" />\n        <AlertDescription>\n          <div className=\"space-y-2\">\n            <div className=\"font-semibold\">\n              Recommended: {recommendation.preferred.toUpperCase()}\n              <Badge className=\"ml-2\" variant=\"outline\">\n                {recommendation.confidence}% confidence\n              </Badge>\n            </div>\n            <div className=\"space-y-1\">\n              {recommendation.reasoning.map((reason, index) => (\n                <div key={index} className=\"flex items-start space-x-2\">\n                  <CheckCircle className=\"h-3 w-3 text-green-500 mt-0.5 flex-shrink-0\" />\n                  <span className=\"text-sm\">{reason}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        </AlertDescription>\n      </Alert>\n    </div>\n  );\n};\n\n/**\n * Main Enhanced Calculator Component\n */\nexport const PremadeEnhancedCalculator: React.FC<PremadeEnhancedCalculatorProps> = ({\n  initialMode = 'diy',\n  region = 'EU',\n  currency = 'EUR',\n  onRecipeGenerated\n}) => {\n  const [caffeineMg, setCaffeineMg] = useState(0)\n  const [selectedBase] = useState('classic')\n  const [selectedFlavor, setSelectedFlavor] = useState('')\n  const [isValid, setIsValid] = useState(true)\n  const [allFlavors, setAllFlavors] = useState<FlavorRecipe[]>([])\n  \n  // Premade mode state\n  const [premadeMode, setPremadeMode] = useState<'diy' | 'premade' | 'hybrid'>(initialMode)\n  const [selectedSyrup, setSelectedSyrup] = useState<PremadeSyrup | null>(null)\n  const [recommendations, setRecommendations] = useState<SyrupRecommendation[]>([])\n  const [costAnalysis, setCostAnalysis] = useState<ComprehensiveCostAnalysis | null>(null)\n  const [preparationTime, setPreparationTime] = useState(0)\n  const [qualityScore, setQualityScore] = useState(0)\n  const [loading, setLoading] = useState(false)\n  const [activeTab, setActiveTab] = useState('calculator')\n  \n  // Initialize services\n  const syrupService = useMemo(() => new PremadeSyrupService(), [])\n  const dilutionService = useMemo(() => new DilutionGuideService(), [])\n  const hybridService = useMemo(() => new HybridRecipeService(syrupService), [syrupService])\n  const costAnalyzer = useMemo(() => new PremadeCostAnalysis(syrupService), [syrupService])\n  \n  // Load flavors\n  useEffect(() => {\n    const loadFlavors = async () => {\n      try {\n        const { loadAllFlavors } = await import('@/data/index')\n        const flavors = await loadAllFlavors()\n        setAllFlavors(flavors)\n      } catch (error) {\n        console.error('Failed to load flavors:', error)\n      }\n    }\n    loadFlavors()\n  }, [])\n  \n  // Calculate premade analysis when mode changes\n  useEffect(() => {\n    if (selectedFlavor && premadeMode !== 'diy') {\n      const calculatePremadeAnalysis = async () => {\n        setLoading(true)\n        try {\n          const flavor = allFlavors.find(f => f.id === selectedFlavor)\n          if (!flavor) return\n          \n          // Get syrup recommendations\n          const syrupRecommendations = syrupService.getRecommendations(flavor.name.toLowerCase(), {\n            availability: 'in-stock'\n          })\n          \n          setRecommendations(syrupRecommendations)\n          \n          if (syrupRecommendations.length > 0) {\n            setSelectedSyrup(syrupRecommendations[0].syrup)\n            \n            // Calculate cost analysis\n            const diyRecipe = {\n              ingredients: flavor.ingredients.map(ing => ({\n                id: ing.ingredientId,\n                name: ing.ingredientId,\n                amount: ing.amount,\n                unit: 'ml',\n                cost: 2.5, // Estimated cost per ingredient\n                supplier: 'local',\n                shelfLife: 30\n              })),\n              laborTime: 25, // 25 minutes for DIY\n              equipmentNeeded: ['digital-scale', 'mixing-bowls', 'whisk'],\n              difficulty: 'intermediate' as const\n            }\n            \n            const analysis = await costAnalyzer.analyzeCostComparison({\n              targetFlavor: flavor.name.toLowerCase(),\n              diyRecipe,\n              targetServingSize: 250,\n              batchSize: 20,\n              region,\n              currency,\n              qualityPreference: 'standard'\n            })\n            \n            setCostAnalysis(analysis)\n            \n            // Set preparation time and quality score based on mode\n            if (premadeMode === 'premade') {\n              setPreparationTime(5) // 5 minutes\n              setQualityScore(75)\n            } else if (premadeMode === 'hybrid') {\n              setPreparationTime(12) // 12 minutes\n              setQualityScore(85)\n            }\n          }\n        } catch (error) {\n          console.error('Failed to calculate premade analysis:', error)\n        } finally {\n          setLoading(false)\n        }\n      }\n      \n      calculatePremadeAnalysis()\n    }\n  }, [selectedFlavor, premadeMode, syrupService, costAnalyzer, allFlavors, region, currency])\n  \n  const currentFlavor = allFlavors.find(f => f.id === selectedFlavor)\n  \n  if (loading && premadeMode !== 'diy') {\n    return (\n      <div className=\"container mx-auto px-4 py-8 max-w-6xl\">\n        <div className=\"space-y-6\">\n          <Skeleton className=\"h-12 w-64\" />\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            <div className=\"space-y-6\">\n              <Skeleton className=\"h-32 w-full\" />\n              <Skeleton className=\"h-32 w-full\" />\n            </div>\n            <div className=\"space-y-6\">\n              <Skeleton className=\"h-32 w-full\" />\n              <Skeleton className=\"h-32 w-full\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n  \n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-6xl\">\n      {/* Header */}\n      <div className=\"mb-12 text-center\">\n        <h1 className=\"text-5xl font-black mb-4 uppercase tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-primary via-white to-primary animate-pulse-slow\">\n          Advanced Recipe Calculator\n        </h1>\n        <p className=\"text-xl text-muted-foreground max-w-3xl mx-auto\">\n          Design your perfect beverage with DIY, Premade, or Hybrid modes. \n          Get cost analysis, quality assessments, and expert recommendations.\n        </p>\n      </div>\n      \n      {/* Mode Selection */}\n      <div className=\"mb-8\">\n        <PremadeModeSelector \n          mode={premadeMode} \n          onModeChange={setPremadeMode} \n        />\n      </div>\n      \n      {/* Main Content Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"calculator\" className=\"flex items-center space-x-2\">\n            <Calculator className=\"h-4 w-4\" />\n            <span>Calculator</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"syrups\" disabled={premadeMode === 'diy'} className=\"flex items-center space-x-2\">\n            <Coffee className=\"h-4 w-4\" />\n            <span>Syrups</span>\n            {recommendations.length > 0 && (\n              <Badge variant=\"secondary\" className=\"ml-1 text-xs\">\n                {recommendations.length}\n              </Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value=\"analysis\" disabled={!costAnalysis} className=\"flex items-center space-x-2\">\n            <BarChart3 className=\"h-4 w-4\" />\n            <span>Analysis</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"guide\" disabled={!selectedSyrup && premadeMode !== 'diy'} className=\"flex items-center space-x-2\">\n            <Info className=\"h-4 w-4\" />\n            <span>Guide</span>\n          </TabsTrigger>\n        </TabsList>\n        \n        {/* Calculator Tab */}\n        <TabsContent value=\"calculator\" className=\"space-y-8\">\n          <div className=\"grid lg:grid-cols-2 gap-8\">\n            <div className=\"space-y-8\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <Zap className=\"h-5 w-5\" />\n                    <span>Caffeine Calculator</span>\n                  </CardTitle>\n                  <CardDescription>\n                    Set your target caffeine content ({premadeMode} mode)\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"text-center\">\n                      <div className=\"text-3xl font-bold text-primary mb-2\">\n                        {caffeineMg}mg\n                      </div>\n                      <div className=\"text-sm text-gray-600\">\n                        Target caffeine per serving\n                      </div>\n                    </div>\n                    <input\n                      type=\"range\"\n                      min=\"0\"\n                      max=\"160\"\n                      step=\"5\"\n                      value={caffeineMg}\n                      onChange={(e) => setCaffeineMg(parseInt(e.target.value))}\n                      className=\"w-full\"\n                    />\n                    <div className=\"flex justify-between text-xs text-gray-500\">\n                      <span>0mg</span>\n                      <span>80mg (Recommended)</span>\n                      <span>160mg (Max)</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              \n              {currentFlavor && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <Settings className=\"h-5 w-5\" />\n                      <span>Selected Flavor</span>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      <div>\n                        <h3 className=\"font-semibold text-lg\">{currentFlavor.name}</h3>\n                        <p className=\"text-gray-600 text-sm\">{currentFlavor.profile}</p>\n                      </div>\n                      \n                      {premadeMode !== 'diy' && selectedSyrup && (\n                        <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                            <span className=\"text-sm font-medium text-green-800\">\n                              Recommended Syrup Selected\n                            </span>\n                          </div>\n                          <div className=\"text-sm text-green-700\">\n                            {selectedSyrup.name} • {selectedSyrup.brand}\n                          </div>\n                        </div>\n                      )}\n                      \n                      {preparationTime > 0 && (\n                        <div className=\"flex items-center space-x-4 text-sm text-gray-600\">\n                          <div className=\"flex items-center space-x-1\">\n                            <Clock className=\"h-4 w-4\" />\n                            <span>{preparationTime} min prep</span>\n                          </div>\n                          {qualityScore > 0 && (\n                            <div className=\"flex items-center space-x-1\">\n                              <Award className=\"h-4 w-4\" />\n                              <span>{qualityScore}% quality</span>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n            \n            <div className=\"space-y-8\">\n              {/* Safety Validation */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <ShieldCheck className=\"h-5 w-5\" />\n                    <span>Safety Validation</span>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center space-x-2\">\n                      <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                      <span className=\"text-sm font-medium\">EU Safety Compliance</span>\n                    </div>\n                    <div className=\"text-sm text-gray-600\">\n                      {caffeineMg <= 160 ? 'Within recommended limits' : 'Exceeds recommended daily intake'}\n                    </div>\n                    \n                    {caffeineMg > 0 && (\n                      <Alert>\n                        <AlertCircle className=\"h-4 w-4\" />\n                        <AlertDescription className=\"text-sm\">\n                          {caffeineMg <= 80 \n                            ? 'Perfect for daily consumption'\n                            : caffeineMg <= 120 \n                            ? 'Suitable for moderate consumption'\n                            : 'Limit to occasional use'\n                          }\n                        </AlertDescription>\n                      </Alert>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n              \n              {/* Cost Summary */}\n              {costAnalysis && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center space-x-2\">\n                      <DollarSign className=\"h-5 w-5\" />\n                      <span>Cost Summary</span>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-sm font-medium\">Total Cost (20 servings)</span>\n                        <span className=\"text-lg font-bold text-primary\">\n                          €{(\n                            premadeMode === 'diy' ? costAnalysis.diy.totalCost :\n                            premadeMode === 'premade' ? costAnalysis.premade.totalCost :\n                            costAnalysis.hybrid.totalCost\n                          ).toFixed(2)}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between items-center text-sm text-gray-600\">\n                        <span>Cost per serving</span>\n                        <span>\n                          €{(\n                            premadeMode === 'diy' ? costAnalysis.diy.costPerServing :\n                            premadeMode === 'premade' ? costAnalysis.premade.costPerServing :\n                            costAnalysis.hybrid.costPerServing\n                          ).toFixed(2)}\n                        </span>\n                      </div>\n                      \n                      {costAnalysis.recommendation.preferred === premadeMode && (\n                        <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n                          <div className=\"flex items-center space-x-2\">\n                            <TrendingUp className=\"h-4 w-4 text-green-600\" />\n                            <span className=\"text-sm font-medium text-green-800\">\n                              Recommended for your preferences\n                            </span>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n              \n              {/* Generate Recipe Button */}\n              {isValid && caffeineMg > 0 && selectedFlavor && (\n                <Card className=\"bg-primary/10 border-primary/50\">\n                  <CardContent className=\"pt-6\">\n                    <div className=\"text-center space-y-4\">\n                      <CheckCircle className=\"h-8 w-8 text-primary mx-auto\" />\n                      <div>\n                        <h3 className=\"font-bold text-primary mb-1\">\n                          Ready to Generate Recipe\n                        </h3>\n                        <p className=\"text-sm text-gray-600\">\n                          Your {premadeMode} recipe is ready with safety validation passed\n                        </p>\n                      </div>\n                      <Button \n                        className=\"w-full\"\n                        onClick={() => {\n                          // Handle recipe generation\n                          onRecipeGenerated?.({\n                            mode: premadeMode,\n                            caffeine: caffeineMg,\n                            flavor: currentFlavor,\n                            syrup: selectedSyrup,\n                            costAnalysis,\n                            preparationTime,\n                            qualityScore\n                          })\n                        }}\n                      >\n                        Generate Recipe\n                        <ArrowRight className=\"h-4 w-4 ml-2\" />\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </div>\n        </TabsContent>\n        \n        {/* Syrups Tab */}\n        <TabsContent value=\"syrups\" className=\"space-y-6\">\n          {recommendations.length > 0 ? (\n            <div>\n              <div className=\"mb-6\">\n                <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                  Recommended Syrups for {currentFlavor?.name}\n                </h2>\n                <p className=\"text-gray-600\">\n                  Top syrup matches based on flavor compatibility and quality\n                </p>\n              </div>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {recommendations.map((recommendation) => (\n                  <SyrupRecommendationCard\n                    key={recommendation.syrup.id}\n                    recommendation={recommendation}\n                    onSelect={setSelectedSyrup}\n                  />\n                ))}\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <Package className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No syrups found</h3>\n              <p className=\"text-gray-600\">Select a flavor to see recommended syrups</p>\n            </div>\n          )}\n        </TabsContent>\n        \n        {/* Analysis Tab */}\n        <TabsContent value=\"analysis\" className=\"space-y-6\">\n          {costAnalysis ? (\n            <CostAnalysisDisplay analysis={costAnalysis} />\n          ) : (\n            <div className=\"text-center py-12\">\n              <BarChart3 className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No analysis available</h3>\n              <p className=\"text-gray-600\">Select a flavor and premade mode to see cost analysis</p>\n            </div>\n          )}\n        </TabsContent>\n        \n        {/* Guide Tab */}\n        <TabsContent value=\"guide\" className=\"space-y-6\">\n          {selectedSyrup ? (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Info className=\"h-5 w-5\" />\n                  <span>Preparation Guide</span>\n                </CardTitle>\n                <CardDescription>\n                  Step-by-step instructions for {selectedSyrup.name}\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                    <h4 className=\"font-semibold text-blue-900 mb-2\">Basic Preparation</h4>\n                    <ol className=\"list-decimal list-inside space-y-1 text-sm text-blue-800\">\n                      <li>Mix {selectedSyrup.dilutionRatio} syrup with water</li>\n                      <li>Stir gently to combine</li>\n                      <li>Add carbonation if desired</li>\n                      <li>Serve immediately or chill</li>\n                    </ol>\n                  </div>\n                  \n                  <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n                    <h4 className=\"font-semibold text-green-900 mb-2\">Storage Tips</h4>\n                    <ul className=\"list-disc list-inside space-y-1 text-sm text-green-800\">\n                      <li>{selectedSyrup.usageGuide.storage}</li>\n                      <li>Shelf life: {selectedSyrup.usageGuide.shelfLife}</li>\n                      <li>Maximum daily intake: {selectedSyrup.usageGuide.maxDaily}ml</li>\n                    </ul>\n                  </div>\n                  \n                  <div className=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\n                    <h4 className=\"font-semibold text-purple-900 mb-2\">Flavor Notes</h4>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {selectedSyrup.tasteProfile.notes.map((note, index) => (\n                        <Badge key={index} variant=\"secondary\">\n                          {note}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"text-center py-12\">\n              <Info className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No guide available</h3>\n              <p className=\"text-gray-600\">Select a syrup to see preparation instructions</p>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  )\n};\n\nexport default PremadeEnhancedCalculator;"
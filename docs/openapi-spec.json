{
  "openapi": "3.0.3",
  "info": {
    "title": "Energy Drink App API",
    "version": "2.0.0",
    "description": "Comprehensive API for the Energy Drink Calculator, Recipe Management, and Analytics Platform. This is the legacy specification - please use the enhanced version for full functionality.",
    "contact": {
      "name": "API Support Team",
      "email": "api-support@energydrink.app"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    },
    {
      "url": "https://api.energydrink.app",
      "description": "Production environment"
    }
  ],
  "externalDocs": {
    "description": "Enhanced API Documentation",
    "url": "https://docs.energydrink.app/api/enhanced"
  },
  "paths": {
    "/auth/verify-age": {
      "post": {
        "summary": "Verify user's age for accessing the application",
        "description": "Validates user's birth year and sets age verification cookie. Required for accessing age-restricted content and features.",
        "operationId": "verifyAge",
        "tags": ["Authentication"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["birthYear"],
                "properties": {
                  "birthYear": {
                    "type": "integer",
                    "minimum": 1900,
                    "maximum": 2010,
                    "example": 1990,
                    "description": "User's birth year for age verification"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Age verified successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "age": {
                      "type": "integer",
                      "example": 34
                    },
                    "verificationDate": {
                      "type": "string",
                      "format": "date-time",
                      "example": "2024-01-15T10:30:00.000Z"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid birth year provided",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Age verification failed or invalid CSRF token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "csrfAuth": []
          }
        ]
      }
    },
    "/auth/check-verification": {
      "get": {
        "summary": "Check current user's age verification status",
        "description": "Returns whether the current user has been verified for age and provides verification details.",
        "operationId": "checkVerification",
        "tags": ["Authentication"],
        "responses": {
          "200": {
            "description": "Verification status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "verified": {
                      "type": "boolean",
                      "example": true
                    },
                    "age": {
                      "type": "integer",
                      "example": 34
                    },
                    "verificationDate": {
                      "type": "string",
                      "format": "date-time",
                      "example": "2024-01-15T10:30:00.000Z"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/csrf-token": {
      "get": {
        "summary": "Generate CSRF token for form submissions",
        "description": "Generates a new CSRF token that must be included in the X-CSRF-Token header for all state-changing operations.",
        "operationId": "generateCSRFToken",
        "tags": ["Security"],
        "responses": {
          "200": {
            "description": "CSRF token generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "csrfToken": {
                      "type": "string",
                      "example": "abc123def456ghi789..."
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/flavors": {
      "get": {
        "summary": "Get all energy drink flavors",
        "description": "Retrieves a list of all available energy drink flavors with their recipes, ingredients, and safety information.",
        "operationId": "getFlavors",
        "tags": ["Core Data"],
        "responses": {
          "200": {
            "description": "List of flavors retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/FlavorRecipe"
                      }
                    },
                    "count": {
                      "type": "integer",
                      "example": 25
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/ingredients": {
      "get": {
        "summary": "Get all ingredients",
        "description": "Retrieves a comprehensive list of all ingredients used in energy drink recipes, including safety information and supplier data.",
        "operationId": "getIngredients",
        "tags": ["Core Data"],
        "responses": {
          "200": {
            "description": "List of ingredients retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Ingredient"
                      }
                    },
                    "count": {
                      "type": "integer",
                      "example": 45
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/suppliers": {
      "get": {
        "summary": "Get all suppliers",
        "description": "Retrieves information about all ingredient suppliers including contact details and product offerings.",
        "operationId": "getSuppliers",
        "tags": ["Core Data"],
        "responses": {
          "200": {
            "description": "List of suppliers retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Supplier"
                      }
                    },
                    "count": {
                      "type": "integer",
                      "example": 15
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/feature-flags": {
      "get": {
        "summary": "Get feature flags",
        "description": "Retrieves all feature flags or evaluates a specific flag based on context parameters.",
        "operationId": "getFeatureFlags",
        "tags": ["Feature Management"],
        "responses": {
          "200": {
            "description": "Feature flags retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "flags": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/FeatureFlag"
                      }
                    },
                    "stats": {
                      "type": "object",
                      "properties": {
                        "total": {
                          "type": "number"
                        },
                        "enabled": {
                          "type": "number"
                        },
                        "disabled": {
                          "type": "number"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      },
      "post": {
        "summary": "Create or update feature flag",
        "description": "Creates a new feature flag or updates an existing one with configuration and rollout rules.",
        "operationId": "createOrUpdateFeatureFlag",
        "tags": ["Feature Management"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FeatureFlag"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Feature flag created or updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "flag": {
                      "$ref": "#/components/schemas/FeatureFlag"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          },
          {
            "csrfAuth": []
          }
        ]
      },
      "delete": {
        "summary": "Delete feature flag",
        "description": "Permanently removes a feature flag from the system.",
        "operationId": "deleteFeatureFlag",
        "tags": ["Feature Management"],
        "parameters": [
          {
            "name": "name",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Name of the feature flag to delete"
          }
        ],
        "responses": {
          "200": {
            "description": "Feature flag deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Flag 'new_feature' removed"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          },
          {
            "csrfAuth": []
          }
        ]
      }
    },
    "/feedback": {
      "post": {
        "summary": "Submit user feedback",
        "description": "Allows users to submit feedback about the application including ratings, comments, and suggestions.",
        "operationId": "submitFeedback",
        "tags": ["Analytics"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "category": {
                    "type": "string"
                  },
                  "rating": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 5
                  },
                  "comment": {
                    "type": "string"
                  },
                  "page": {
                    "type": "string"
                  },
                  "priority": {
                    "type": "string",
                    "enum": ["low", "medium", "high", "critical"]
                  },
                  "gdprConsent": {
                    "type": "boolean"
                  }
                },
                "required": ["category", "rating", "comment", "gdprConsent"]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Feedback submitted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Thank you for your feedback!"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          },
          {
            "csrfAuth": []
          }
        ]
      },
      "get": {
        "summary": "Get feedback submissions",
        "description": "Retrieves user feedback submissions with optional filtering and pagination.",
        "operationId": "getFeedback",
        "tags": ["Analytics"],
        "responses": {
          "200": {
            "description": "Feedback submissions retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "count": {
                      "type": "integer",
                      "example": 45
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/gdpr/data": {
      "get": {
        "summary": "Get user data (GDPR access request)",
        "description": "Provides all user data stored by the application as required by GDPR Article 15 (Right of Access).",
        "operationId": "getUserData",
        "tags": ["GDPR Compliance"],
        "responses": {
          "200": {
            "description": "User data retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "ageVerified": {
                          "type": "boolean"
                        },
                        "verificationTimestamp": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "dataRetentionDays": {
                          "type": "number"
                        },
                        "dataPurposes": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "dataRecipients": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "legalBasis": {
                          "type": "string"
                        }
                      }
                    },
                    "rights": {
                      "type": "object",
                      "properties": {
                        "access": {
                          "type": "boolean"
                        },
                        "rectification": {
                          "type": "boolean"
                        },
                        "erasure": {
                          "type": "boolean"
                        },
                        "restriction": {
                          "type": "boolean"
                        },
                        "portability": {
                          "type": "boolean"
                        },
                        "objection": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      },
      "delete": {
        "summary": "Delete user data (GDPR right to erasure)",
        "description": "Permanently deletes all user data as required by GDPR Article 17 (Right to Erasure).",
        "operationId": "deleteUserData",
        "tags": ["GDPR Compliance"],
        "responses": {
          "200": {
            "description": "User data deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "All user data has been deleted"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          },
          {
            "csrfAuth": []
          }
        ]
      }
    },
    "/gdpr/status": {
      "get": {
        "summary": "Check GDPR compliance status",
        "description": "Determines if GDPR regulations apply to the current user and their consent status.",
        "operationId": "getGDPRStatus",
        "tags": ["GDPR Compliance"],
        "responses": {
          "200": {
            "description": "GDPR status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "isEU": {
                      "type": "boolean"
                    },
                    "hasConsent": {
                      "type": "boolean"
                    },
                    "consentRequired": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    },
    "/health": {
      "get": {
        "summary": "Application health check",
        "description": "Provides comprehensive health status of the application including uptime, environment, and system metrics.",
        "operationId": "healthCheck",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "Application is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "uptime": {
                      "type": "number"
                    },
                    "environment": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "cookieAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "age-verified"
      },
      "csrfAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-CSRF-Token"
      }
    },
    "schemas": {
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          }
        }
      },
      "FeatureFlag": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "enabled": {
            "type": "boolean"
          },
          "rolloutPercentage": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "conditions": {
            "type": "object",
            "properties": {
              "userId": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "environment": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "custom": {
                "type": "object"
              }
            }
          },
          "metadata": {
            "type": "object",
            "properties": {
              "description": {
                "type": "string"
              },
              "owner": {
                "type": "string"
              },
              "createdAt": {
                "type": "string",
                "format": "date-time"
              },
              "updatedAt": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        },
        "required": [
          "name",
          "enabled"
        ]
      },
      "FlavorRecipe": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "profile": {
            "type": "string"
          },
          "ingredients": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "ingredientId": {
                  "type": "string"
                },
                "amount": {
                  "type": "number"
                }
              }
            }
          },
          "compatibleBases": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "id",
          "name",
          "profile",
          "ingredients",
          "compatibleBases"
        ]
      },
      "Ingredient": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "category": {
            "type": "string"
          },
          "unit": {
            "type": "string"
          },
          "safety": {
            "type": "object",
            "properties": {
              "maxDaily": {
                "type": "number"
              },
              "warningThreshold": {
                "type": "number"
              },
              "euCompliant": {
                "type": "boolean"
              },
              "banned": {
                "type": "boolean"
              }
            }
          },
          "suppliers": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "id",
          "name",
          "category",
          "unit",
          "safety",
          "suppliers"
        ]
      },
      "Supplier": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "url": {
            "type": "string"
          },
          "location": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "name",
          "url",
          "location"
        ]
      }
    }
  },
  "tags": [
    {
      "name": "Authentication",
      "description": "User authentication and age verification endpoints"
    },
    {
      "name": "Security",
      "description": "Security-related endpoints like CSRF token generation"
    },
    {
      "name": "Core Data",
      "description": "Core data endpoints for flavors, ingredients, and suppliers"
    },
    {
      "name": "Feature Management",
      "description": "Feature flag management and configuration"
    },
    {
      "name": "Analytics",
      "description": "Analytics and feedback collection endpoints"
    },
    {
      "name": "GDPR Compliance",
      "description": "GDPR compliance and data rights endpoints"
    },
    {
      "name": "System",
      "description": "System health and monitoring endpoints"
    }
  ]
}